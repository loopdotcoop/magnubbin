<!DOCTYPE html>
<html lang="en">
<head>
  <title>index.html</title>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
  <meta name="generator" content="Apage 0.0.22 http://apage.richplastow.com/">
  <style>
    /* ‘Inspect Element’ here, for Apage’s injected CSS */
  </style>

  <script>

//// When the DOM is ready, set up Apage and inject the plugins. 
window.addEventListener('load', function () { (function (d) { 'use strict'; 


//// Declare iterator, length and HTML-reference variables. 
var i, l, $ref


//// Initialize three arrays which are available to all Apage plugins. 
 ,arts      = []
 ,resolvers = []
 ,updaters  = []


//// Like jQuery, but native. 
 ,$  = d.querySelector.bind(d)
 ,$$ = d.querySelectorAll.bind(d)


//// Get a reference to all `<article class="apage">` elements. 
 ,$arts = $$('article.apage')


//// Convert JavaScript’s native `arguments` object to an array. 
 ,getArgs = function (args, offset) {
    return Array.prototype.slice.call(args, offset || 0);
 }


//// `unattribute($ref,'data-apage-','opath'...)` removes data attributes. 
 ,unattribute = function ($ref, prefix) {
    for ( var i=0, suffs=getArgs(arguments,2), l=suffs.length; i<l; i++ ) {
      $ref.removeAttribute(prefix + suffs[i]);
    }
  }


//// Runs each resolver in order. These are added by the plugins, below. 
//// Resolvers are used to map a query to an article. 
 ,resolve = function (query) {
    for (var i=0, l=resolvers.length, backstop, result={}; i<l; i++) {
      result = resolvers[i](query);
      if (result.art) { break; } // `query` does resolve to an article
      backstop = result.backstop || backstop; // may return a backstop
    }
    return result.art ? result.art : backstop; //@todo test logic of 'last valid backstop return' with several plugins at once
  }


//// Runs each updater in order. These are added by the plugins, below. 
//// Updaters change the current DOM state, eg to show a single article. 
 ,update = function (query) {
    for (var i=0, l=updaters.length, current=resolve(query); i<l; i++) {
      updaters[i](current);
    }
  }


//// Tidies the URL hash and runs `update()` when the URL hash changes. 
 ,onHashchange = function (event) {
    update( window.location.hash.substr(1).replace(/\//g,'_') );
    if (event) { event.preventDefault(); }
  }

;


//// Populate the `arts` array using data from Apage `<ARTICLE>` elements. 
//// Then, remove all 'data-apage-*' attributes except 'data-apage-dname'. 
for (i=0, l=$arts.length; i<l; i++) {
  $ref = $arts[i];
  arts.push({
    id:    $ref.getAttribute('id')
   ,opath: $ref.getAttribute('data-apage-opath')
   ,dname: $ref.getAttribute('data-apage-dname')
   ,order: $ref.getAttribute('data-apage-order')
   ,front: JSON.parse( $ref.getAttribute('data-apage-front') )
   ,title: $ref.getAttribute('data-apage-title')
   ,$ref:  $ref
  });
  unattribute($ref,'data-apage-','opath','order','front','title');
}


//// Begin injecting plugins. 

// Generated by CoffeeScript 1.9.2

/*! Apage 0.0.22 //// MIT Licence //// http://apage.richplastow.com/
 *  plugin/cross-browser.litcoffee
 */

(function() {
  $('style').innerHTML += "\n/* injected by Apage’s CrossBrowser plugin, and adapted from: */\n/* normalize.css v3.0.3 | MIT License | github.com/necolas/normalize.css */\n\n/* Document */\nhtml { font-family:sans-serif; -ms-text-size-adjust:100%; -webkit-text-size-adjust:100% }\nbody { margin:0 }\n\n/* HTML5 */\narticle,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,\nsection,summary { display:block }\naudio,canvas,progress,video { display:inline-block; vertical-align:baseline }\naudio:not([controls]) { display:none; height:0 }\n[hidden],template { display:none }\n\n/* Links */\na { background-color:transparent }\na:active,a:hover { outline:0 }\n\n/* Text */\nabbr[title] { border-bottom:1px dotted }\nb, strong { font-weight:bold }\ndfn { font-style:italic }\nh1 { font-size:2em; margin:0.67em 0 }\nmark { background:#ff0; color:#000 }\nsmall { font-size:80% }\nsub,sup { font-size:75%; line-height:0; position:relative; vertical-align:baseline }\nsup { top:-0.5em }\nsub { bottom:-0.25em }\n\n/* Embedded */\nimg { border:0 }\nsvg:not(:root) { overflow:hidden }\n\n/* Grouping */\nfigure { margin:1em 40px }\nhr { box-sizing:content-box; height:0 }\npre { overflow:auto }\ncode,kbd,pre,samp { font-family:monospace,monospace; font-size:1em }\n\n/* Forms */\nbutton,input,optgroup,select,textarea { color:inherit; font:inherit; margin:0 }\nbutton { overflow:visible }\nbutton,select { text-transform:none }\nbutton,html input[type=\"button\"],input[type=\"reset\"],\ninput[type=\"submit\"] { -webkit-appearance:button; cursor:pointer }\nbutton[disabled],html input[disabled] { cursor:default }\nbutton::-moz-focus-inner,input::-moz-focus-inner{ border:0; padding:0 }\ninput { line-height:normal }\ninput[type=\"checkbox\"],input[type=\"radio\"] { box-sizing:border-box; padding:0 }\ninput[type=\"number\"]::-webkit-inner-spin-button,\ninput[type=\"number\"]::-webkit-outer-spin-button { height:auto }\ninput[type=\"search\"] { -webkit-appearance:textfield; box-sizing:content-box }\ninput[type=\"search\"]::-webkit-search-cancel-button,\ninput[type=\"search\"]::-webkit-search-decoration { -webkit-appearance:none }\nfieldset { border:1px solid #c0c0c0; margin:0 2px; padding:0.35em 0.625em 0.75em }\nlegend { border:0; padding:0 }\ntextarea { overflow:auto }\noptgroup { font-weight:bold }\n\n/* Tables */\ntable { border-collapse:collapse; border-spacing:0 }\ntd,th { padding:0 }\n";

}).call(this);
// Generated by CoffeeScript 1.9.2

/*! Apage 0.0.22 //// MIT Licence //// http://apage.richplastow.com/
 *  plugin/pagination.litcoffee
 */

(function() {
  var $ref, art, i, len;

  $('style').innerHTML += "\n/* injected by Apage’s Pagination plugin */\narticle { display: none; }\narticle.active { display: block; }";

  $ref = document.createElement('article');

  $ref.setAttribute('class', 'apage');

  $ref.setAttribute('id', 'apage_undefined');

  $ref.innerHTML = "<!-- injected by Apage’s Pagination plugin -->\n<h1>Article Not Found</h1>";

  d.body.appendChild($ref);

  arts.push({
    id: 'undefined',
    opath: '',
    dname: '',
    order: 0,
    front: [],
    title: 'Article Not Found',
    $ref: $ref
  });

  for (i = 0, len = arts.length; i < len; i++) {
    art = arts[i];
    arts[art.id] = art;
  }

  arts['_'] = arts[0] || arts.undefined;

  resolvers.push(function(query) {
    if (!query) {
      return {
        art: arts[0]
      };
    }
    if (arts[query]) {
      return {
        art: arts[query]
      };
    }
    query = 'apage' + query;
    if (arts[query]) {
      return {
        art: arts[query]
      };
    }
    return {
      backstop: arts.undefined
    };
  });

  updaters.push(function(current) {
    var j, len1;
    for (j = 0, len1 = arts.length; j < len1; j++) {
      art = arts[j];
      art.$ref.className = art.$ref.className.replace(/\s*active|\s*$/g, '');
    }
    current.$ref.className += ' active';
    return d.title = current.title;
  });

}).call(this);
// Generated by CoffeeScript 1.9.2

/*! Ookonsole 0.0.7 //// MIT Licence //// http://ookonsole.richplastow.com/ */

(function() {
  var Main, Task, zz, ª, ªA, ªB, ªC, ªE, ªF, ªN, ªO, ªR, ªS, ªU, ªV, ªX, ªcommonPrefix, ªex, ªhas, ªredefine, ªtype, ªuid,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  ªC = 'Ookonsole';

  ªV = '0.0.7';

  ªA = 'array';

  ªB = 'boolean';

  ªE = 'error';

  ªF = 'function';

  ªN = 'number';

  ªO = 'object';

  ªR = 'regexp';

  ªS = 'string';

  ªU = 'undefined';

  ªX = this;

  ª = console.log.bind(console);

  ªex = function(x, a, b) {
    var pos;
    if (-1 === (pos = a.indexOf(x))) {
      return x;
    } else {
      return b.charAt(pos);
    }
  };

  ªhas = function(h, n, t, f) {
    if (t == null) {
      t = true;
    }
    if (f == null) {
      f = false;
    }
    if (-1 !== h.indexOf(n)) {
      return t;
    } else {
      return f;
    }
  };

  ªtype = function(x) {
    return {}.toString.call(x).match(/\s([a-z|A-Z]+)/)[1].toLowerCase();
  };

  ªuid = function(p) {
    return p + '_' + (Math.random() + '1111111111111111').slice(2, 18);
  };

  ªcommonPrefix = function(strings) {
    var a, first, i, l, last;
    a = strings.concat().sort();
    first = a[0];
    last = a[a.length - 1];
    l = first.length;
    i = 0;
    while (i < l && first.charAt(i) === last.charAt(i)) {
      i++;
    }
    return first.slice(0, i);
  };

  ªredefine = function(obj, name, value, kind) {
    switch (kind) {
      case 'constant':
        return Object.defineProperty(obj, name, {
          value: value,
          enumerable: true
        });
      case 'private':
        return Object.defineProperty(obj, name, {
          value: value,
          enumerable: false
        });
    }
  };

  Main = (function() {
    Main.prototype.C = ªC;

    Main.prototype.toString = function() {
      return "[object " + this.C + "]";
    };

    function Main(config) {
      if (config == null) {
        config = {};
      }
      this.onKeydown = bind(this.onKeydown, this);
      this.addTask = bind(this.addTask, this);
      this.context = config.context || null;
      if (ªO !== typeof this.context) {
        throw Error("`config.context` is type " + (typeof this.context) + " not 'object'");
      }
      this.unrecognized = new Task({
        summary: "Used when the requested task does not exist",
        completions: [],
        details: "This task is not used directly",
        runner: function(context, options) {
          return "That task does not exist: type `help` to list commands";
        }
      });
      this.tasks = {
        help: new Task({
          summary: "Show this help. Type `help help` for more details",
          completions: ['help '],
          details: "help\n----\nA built-in ookonsole task, which shows helpful usage information. \n\nhelp         With no options, lists and summarizes all available tasks\nhelp <task>  Shows details about the given task, eg `help clear`, to \n             display details on `clear` and its options\n",
          runner: (function(_this) {
            return function(context, options) {
              var name, task;
              switch (options.length) {
                case 0:
                  return ((function() {
                    var ref, results;
                    ref = this.tasks;
                    results = [];
                    for (name in ref) {
                      task = ref[name];
                      results.push(name + ": " + task.summary);
                    }
                    return results;
                  }).call(_this)).join('\n');
                case 1:
                  if (_this.tasks[options[0]]) {
                    return _this.tasks[options[0]].details;
                  } else {
                    return "That task does not exist: type `help` to list commands";
                  }
                  break;
                default:
                  return "Too many options: try `help " + options[0] + "`";
              }
            };
          })(this)
        }),
        clear: new Task({
          summary: "Delete the contents of the log",
          completions: ['clear display', 'clear storage', 'clear all'],
          details: "clear\n-----\nA built-in ookonsole task, which shows helpful usage information. \n\nclear display  Clears the log display, but leaves the in-storage log intact\nclear storage  Deletes localStorage (browser) or filesystem (server) logs\nclear all      Both of the above\nclear          With no options, runs `clear display`\n",
          runner: (function(_this) {
            return function(context, options) {
              switch (options.length) {
                case 0:
                  _this.$display.innerHTML = '';
                  return false;
                case 1:
                  if ('display' === options[0]) {
                    return _this.tasks.clear.runner(context, []);
                  } else {
                    return "@todo";
                  }
                  break;
                default:
                  return "Too many options: try `clear " + options[0] + "`";
              }
            };
          })(this)
        })
      };
      if (ªU === ªtype(config.$wrap)) {
        this.$wrap = null;
      } else if (config.$wrap instanceof ªX.HTMLElement) {
        this.$wrap = config.$wrap;
      } else {
        throw Error("`config.$wrap` is not an instance of `HTMLElement`");
      }
      if (!this.$wrap) {
        this.$style = null;
      } else {
        this.$style = ªX.document.createElement('style');
        this.$style.innerHTML = this.getStyle();
      }
      if (!this.$wrap) {
        this.$box = null;
      } else {
        this.$box = ªX.document.createElement('div');
        this.$box.setAttribute('class', 'ookonsole-box');
      }
      if (!this.$wrap) {
        this.$display = config.$display || null;
      } else {
        this.$display = ªX.document.createElement('pre');
        this.$display.setAttribute('class', 'ookonsole-display');
        this.$box.appendChild(this.$display);
      }
      if (!this.$wrap) {
        this.$command = config.$command || null;
      } else {
        this.$command = ªX.document.createElement('input');
        this.$command.setAttribute('class', 'ookonsole-command');
        this.$box.appendChild(this.$command);
      }
      this.pointer = null;
    }

    Main.prototype.show = function() {
      var ref, ref1;
      if ((ref = this.$wrap) != null) {
        ref.appendChild(this.$style);
      }
      return (ref1 = this.$wrap) != null ? ref1.appendChild(this.$box) : void 0;
    };

    Main.prototype.hide = function() {
      var ref, ref1;
      if ((ref = this.$wrap) != null) {
        ref.removeChild(this.$style);
      }
      return (ref1 = this.$wrap) != null ? ref1.removeChild(this.$box) : void 0;
    };

    Main.prototype.start = function() {
      var ref, ref1;
      if ((ref = this.$command) != null) {
        ref.focus();
      }
      return (ref1 = this.$command) != null ? ref1.addEventListener('keydown', this.onKeydown) : void 0;
    };

    Main.prototype.stop = function() {
      return ª(456);
    };

    Main.prototype.addTask = function(name, config) {
      return this.tasks[name] = new Task(config);
    };

    Main.prototype.onKeydown = function(event) {
      var log, nextCommandEnd, nextCommandStart, prevCommandEnd, prevCommandStart;
      switch (event.keyCode) {
        case 13:
          return this.execute(this.$command.value);
        case 9:
          this.autocomplete(this.$command.value);
          return event.preventDefault();
        case 38:
          log = this.$display.innerHTML;
          this.pointer = null === this.pointer ? log.length : this.pointer;
          prevCommandStart = log.lastIndexOf('§ ', this.pointer);
          if (-1 === prevCommandStart) {
            return;
          }
          prevCommandEnd = log.indexOf('\n', prevCommandStart);
          if (-1 === prevCommandEnd) {
            return;
          }
          this.pointer = prevCommandStart - 1;
          this.$command.value = log.slice(prevCommandStart + 2, prevCommandEnd);
          return event.preventDefault();
        case 40:
          log = this.$display.innerHTML;
          this.pointer = null === this.pointer ? log.length : this.pointer + 2;
          nextCommandStart = log.indexOf('§ ', this.pointer);
          if (-1 === nextCommandStart) {
            return;
          }
          nextCommandEnd = log.indexOf('\n', nextCommandStart);
          if (-1 === nextCommandEnd) {
            return;
          }
          this.pointer = nextCommandStart;
          return this.$command.value = log.slice(nextCommandStart + 2, nextCommandEnd);
      }
    };

    Main.prototype.autocomplete = function(command) {
      var candidates, completion, j, len, name, ref, ref1, task;
      candidates = [];
      ref = this.tasks;
      for (name in ref) {
        task = ref[name];
        ref1 = task.completions;
        for (j = 0, len = ref1.length; j < len; j++) {
          completion = ref1[j];
          if ((completion.slice(0, command.length)) === command) {
            candidates.push(completion);
          }
        }
      }
      if (1 === candidates.length) {
        return this.$command.value = candidates[0];
      } else if (0 !== candidates.length) {
        return this.$command.value = ªcommonPrefix(candidates);
      }
    };

    Main.prototype.execute = function(command) {
      var hasScrolledToEnd, i, options, result, task;
      this.pointer = null;
      hasScrolledToEnd = this.$display.scrollTop > this.$display.scrollHeight - this.$display.offsetHeight;
      this.$display.innerHTML += "§ " + command + "\n";
      this.$command.value = '';
      options = command.split(' ');
      i = options.length;
      while (0 < i--) {
        if ('' === options[i]) {
          options.splice(i, 1);
        }
      }
      if (options.length) {
        task = this.tasks[options.shift()];
      } else {
        return;
      }
      if (!task) {
        task = this.unrecognized;
      }
      result = task.runner(this.context, options);
      if (false !== result) {
        this.$display.innerHTML += (result.replace(/</g, '&lt;')) + '\n';
      }
      if (hasScrolledToEnd) {
        return this.$display.scrollTop = this.$display.scrollHeight;
      }
    };

    Main.prototype.getStyle = function() {
      return ".ookonsole-box {\n  padding:    0.5rem;\n  border:     1px solid #999;\n}\n.ookonsole-display {\n  margin:     0;\n  padding:    0.5rem;\n  border:     1px solid #999;\n  font:       1rem/1.3rem monaco, monospace;\n}\n.ookonsole-command {\n  display:    block;\n  box-sizing: border-box;\n  width:      100%;\n  padding:    0.5rem;\n  border:     1px solid #999;\n  font:       1rem/1.3rem monaco, monospace;\n}";
    };

    return Main;

  })();

  zz = function(xx) {};

  Task = (function() {
    Task.prototype.C = 'Task';

    Task.prototype.toString = function() {
      return "[object " + this.C + "]";
    };

    function Task(config) {
      var completion, j, len, ref;
      if (config == null) {
        config = {};
      }
      this.summary = config.summary;
      if (ªS !== ªtype(this.summary)) {
        throw Error("`config.summary` is '" + (ªtype(this.summary)) + "' not 'string'");
      }
      this.completions = config.completions;
      if (ªA !== ªtype(this.completions)) {
        throw Error("`config.completions` is '" + (ªtype(this.completions)) + "' not 'array'");
      }
      ref = this.completions;
      for (j = 0, len = ref.length; j < len; j++) {
        completion = ref[j];
        if (ªS !== ªtype(completion)) {
          throw Error("`config.completions` contains '" + (ªtype(completion)) + "' not 'string'");
        }
      }
      this.details = config.details;
      if (ªS !== ªtype(this.details)) {
        throw Error("`config.details` is '" + (ªtype(this.details)) + "' not 'string'");
      }
      this.runner = config.runner;
      if (ªF !== ªtype(this.runner)) {
        throw Error("`config.runner` is '" + (ªtype(this.runner)) + "' not 'function'");
      }
    }

    Task.prototype.run = function() {
      return this.runner.apply(context, options);
    };

    return Task;

  })();

  if (ªF === typeof define && define.amd) {
    define(function() {
      return Main;
    });
  } else if (ªO === typeof module && module && module.exports) {
    module.exports = Main;
  } else {
    this[ªC] = Main;
  }

}).call(this);
// Generated by CoffeeScript 1.9.2

/*! Nwang 0.0.3 //// MIT Licence //// http://nwang.richplastow.com/ */

(function() {
  var Main, ª, ªA, ªB, ªC, ªE, ªF, ªN, ªO, ªR, ªS, ªU, ªV, ªW, ªX, ªex, ªhas, ªredefine, ªtype, ªuid;

  ªC = 'Nwang';

  ªV = '0.0.3';

  ªA = 'array';

  ªB = 'boolean';

  ªE = 'error';

  ªF = 'function';

  ªN = 'number';

  ªO = 'object';

  ªR = 'regexp';

  ªS = 'string';

  ªU = 'undefined';

  ªX = 'null';

  ªW = this;

  ª = console.log.bind(console);

  ªex = function(x, a, b) {
    var pos;
    if (-1 === (pos = a.indexOf(x))) {
      return x;
    } else {
      return b.charAt(pos);
    }
  };

  ªhas = function(h, n, t, f) {
    if (t == null) {
      t = true;
    }
    if (f == null) {
      f = false;
    }
    if (-1 !== h.indexOf(n)) {
      return t;
    } else {
      return f;
    }
  };

  ªtype = function(x) {
    return {}.toString.call(x).match(/\s([a-z0-9]+)/i)[1].toLowerCase();
  };

  ªuid = function(p) {
    return p + '_' + (Math.random() + '1111111111111111').slice(2, 18);
  };

  ªredefine = function(obj, name, value, kind) {
    switch (kind) {
      case 'constant':
        return Object.defineProperty(obj, name, {
          value: value,
          enumerable: true
        });
      case 'private':
        return Object.defineProperty(obj, name, {
          value: value,
          enumerable: false
        });
    }
  };

  Main = (function() {
    Main.prototype.C = ªC;

    Main.prototype.toString = function() {
      return "[object " + this.C + "]";
    };

    function Main(config) {
      if (config == null) {
        config = {};
      }
      this.xx = null;
    }

    Main.prototype.sf3 = function(x) {
      var M, tx, u;
      M = '/nwang/src/class-main.litcoffee:Main:sf3()\n  ';
      tx = typeof x;
      if (ªN === tx) {
        if (-10000 > x) {
          throw RangeError(M + "`x` is < -10000");
        }
        if (-1000 > x) {
          return String.fromCharCode(0xAFE8 + Math.round(x / 10));
        }
        if (-100 > x) {
          return String.fromCharCode(0xB36C + Math.round(x));
        }
        if (-10 > x) {
          return String.fromCharCode(0xB6F0 + Math.round(x * 10));
        }
        if (-1 > x) {
          return String.fromCharCode(0xBA74 + Math.round(x * 100));
        }
        if (-0.1 > x) {
          return String.fromCharCode(0xBDF8 + Math.round(x * 1000));
        }
        if (0.1 > x) {
          return String.fromCharCode(0xC17C + Math.round(x * 10000));
        }
        if (1 > x) {
          return String.fromCharCode(0xC500 + Math.round(x * 1000));
        }
        if (10 > x) {
          return String.fromCharCode(0xC884 + Math.round(x * 100));
        }
        if (100 > x) {
          return String.fromCharCode(0xCC08 + Math.round(x * 10));
        }
        if (1000 > x) {
          return String.fromCharCode(0xCF8C + Math.round(x));
        }
        if (10000 >= x) {
          return String.fromCharCode(0xD310 + Math.round(x / 10));
        }
        if (x !== x) {
          throw RangeError(M + "`x` is not a number");
        }
        throw RangeError(M + "`x` is > 10000");
      }
      if (ªS === tx) {
        u = x.charCodeAt(0);
        if (0xAC00 > u) {
          throw RangeError(M + "`x` codepoint " + u + " < " + 0xAC00);
        }
        if (0xAF85 > u) {
          return '' + ((u - 0xAFE8) * 10);
        }
        if (0xB309 > u) {
          return '' + (u - 0xB36C);
        }
        if (0xB68D > u) {
          return ((u - 0xB6F0) * 0.1).toFixed(1);
        }
        if (0xBA11 > u) {
          return ((u - 0xBA74) * 0.01).toFixed(2);
        }
        if (0xBD95 > u) {
          return ((u - 0xBDF8) * 0.001).toFixed(3);
        }
        if (0xC564 > u) {
          return ((u - 0xC17C) * 0.0001).toFixed(4);
        }
        if (0xC8E8 > u) {
          return ((u - 0xC500) * 0.001).toFixed(3);
        }
        if (0xCC6C > u) {
          return ((u - 0xC884) * 0.01).toFixed(2);
        }
        if (0xCFF0 > u) {
          return ((u - 0xCC08) * 0.1).toFixed(1);
        }
        if (0xD374 > u) {
          return '' + (u - 0xCF8C);
        }
        if (0xD6F8 >= u) {
          return '' + ((u - 0xD310) * 10);
        }
        if (u !== u) {
          throw RangeError(M + "`x` is an empty string");
        }
        throw RangeError(M + "`x` codepoint " + u + " > " + 0xD6F8);
      }
      throw TypeError(M + "`x` is " + tx + " not number|string");
    };

    return Main;

  })();

  if (ªF === typeof define && define.amd) {
    define(function() {
      return Main;
    });
  } else if (ªO === typeof module && module && module.exports) {
    module.exports = Main;
  } else {
    this[ªC] = Main;
  }

}).call(this);
// Generated by CoffeeScript 1.9.2

/*! Oo3d 0.0.55 //// MIT Licence //// http://oo3d.richplastow.com/ */

(function() {
  var Buffer, Item, Layer, Main, Nwang, Program, Renderer, mat4, pick, uri, ª, ªA, ªB, ªC, ªE, ªF, ªMAX, ªMIN, ªN, ªO, ªR, ªS, ªU, ªV, ªW, ªX, ªex, ªhas, ªis, ªisU, ªredefine, ªtype, ªuid,
    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    hasProp = {}.hasOwnProperty;

  ªC = 'Oo3d';

  ªV = '0.0.55';

  ªA = 'array';

  ªB = 'boolean';

  ªE = 'error';

  ªF = 'function';

  ªN = 'number';

  ªO = 'object';

  ªR = 'regexp';

  ªS = 'string';

  ªU = 'undefined';

  ªX = 'null';

  ªMAX = 9007199254740991;

  ªMIN = -9007199254740991;

  ªW = this;

  ª = console.log.bind(console);

  ªex = function(x, a, b) {
    var pos;
    if (-1 === (pos = a.indexOf(x))) {
      return x;
    } else {
      return b.charAt(pos);
    }
  };

  ªis = function(c, t, f) {
    if (t == null) {
      t = true;
    }
    if (f == null) {
      f = false;
    }
    if (c) {
      return t;
    } else {
      return f;
    }
  };

  ªhas = function(h, n, t, f) {
    if (t == null) {
      t = true;
    }
    if (f == null) {
      f = false;
    }
    if (-1 !== h.indexOf(n)) {
      return t;
    } else {
      return f;
    }
  };

  ªtype = function(x) {
    return {}.toString.call(x).match(/\s([a-z0-9]+)/i)[1].toLowerCase();
  };

  ªisU = function(x) {
    return ªU === typeof x;
  };

  ªuid = function(p) {
    return p + '_' + (Math.random() + '1111111111111111').slice(2, 18);
  };

  ªredefine = function(obj, name, value, kind) {
    switch (kind) {
      case 'constant':
        return Object.defineProperty(obj, name, {
          value: value,
          enumerable: true
        });
      case 'private':
        return Object.defineProperty(obj, name, {
          value: value,
          enumerable: false
        });
    }
  };

  Main = (function() {
    var deleteOne;

    Main.prototype.C = 'Oo3d';

    Main.prototype.toString = function() {
      return "[object Oo3d]";
    };

    function Main(config) {
      var M, k, v;
      if (config == null) {
        config = {};
      }
      M = "/oo3d/src/class-main.litcoffee Oo3d()\n  ";
      if (ªO !== ªtype(config)) {
        throw TypeError(M + "Optional `config` is " + (ªtype(config)) + " not object");
      }
      for (k in config) {
        v = config[k];
        this[k] = v;
      }
      if (!Nwang) {
        throw Error(M + "Dependency 'Nwang' could not be found");
      }
      this.nwang = new Nwang;
      this.$main = config.$main || null;
      if (this.$main && '[object HTMLCanvasElement]' !== '' + this.$main) {
        throw TypeError(M + "Optional `config.$main` is " + (ªtype(this.$main)) + " not HTMLCanvasElement");
      }
      this.oT = config.oT || 'trs';
      if (!{
        'trs': 1,
        'rts': 1,
        'srt': 1
      }[this.oT]) {
        throw RangeError(M + "Optional `config.oT` is not 'trs|rts|srt'");
      }
      if (!config.bkgnd) {
        this.bkgndR = this.bkgndG = this.bkgndB = 0.25;
        this.bkgndA = 1;
      } else if ('float32array' === ªtype(config.bkgnd)) {
        if (4 !== config.bkgnd.length) {
          throw Error(M + "If set `config.bkgnd` must contain four elements");
        }
        this.bkgndR = config.bkgnd[0] || 0;
        this.bkgndG = config.bkgnd[1] || 0;
        this.bkgndB = config.bkgnd[2] || 0;
        this.bkgndA = config.bkgnd[3] || 0;
        if (0 > this.bkgndR || this.bkgndR > 1) {
          throw RangeError(M + "`config.bkgnd[0]` (red) is not within range 0-1");
        }
        if (0 > this.bkgndG || this.bkgndG > 1) {
          throw RangeError(M + "`config.bkgnd[1]` (green) is not within range 0-1");
        }
        if (0 > this.bkgndB || this.bkgndB > 1) {
          throw RangeError(M + "`config.bkgnd[2]` (blue) is not within range 0-1");
        }
        if (0 > this.bkgndA || this.bkgndA > 1) {
          throw RangeError(M + "`config.bkgnd[3]` (alpha) is not within range 0-1");
        }
      } else {
        throw TypeError(M + "Optional `config.bkgnd` is " + (ªtype(config.bkgnd)) + " not float32array");
      }
      this.gl = null;
      this._all = [];
      this.layers = [];
      if (this.$main) {
        this.initGL();
        if (this.gl) {
          this.initCanvas();
          this.initBuffers();
        }
      }
    }

    Main.prototype.initGL = function() {
      var M, ctx, j, len, ref;
      M = this.C + ":initGL()\n  ";
      try {
        ref = ['webgl', 'experimental-webgl'];
        for (j = 0, len = ref.length; j < len; j++) {
          ctx = ref[j];
          this.gl = this.$main.getContext(ctx, {
            preserveDrawingBuffer: true
          });
          if (this.gl) {
            break;
          }
        }
      } catch (_error) {

      }
      if (!this.gl) {
        throw Error(M + "Unable to initialize WebGL. Your browser may not support it.");
      }
    };

    Main.prototype.initCanvas = function() {
      this.gl.clearColor(this.bkgndR, this.bkgndG, this.bkgndB, this.bkgndA);
      this.gl.enable(this.gl.DEPTH_TEST);
      this.gl.enable(this.gl.SCISSOR_TEST);
      this.gl.depthFunc(this.gl.LEQUAL);
      this.gl.scissor(0, 0, this.$main.width, this.$main.height);
      this.gl.clear(this.gl.COLOR_BUFFER_BIT | this.gl.DEPTH_BUFFER_BIT);
      return this.gl.enable(this.gl.VERTEX_PROGRAM_POINT_SIZE);
    };

    Main.prototype.initBuffers = function() {
      this.add('Buffer.Position', {
        data: []
      });
      return this.add('Buffer.Color', {
        data: []
      });
    };

    Main.prototype.cleanUp = function() {};

    Main.prototype.browse = function(search) {
      var M;
      M = "/oo3d/src/class-main.litcoffee Main:browse()\n  ";
      return [];
    };

    Main.prototype.read = function(target, format) {
      var M;
      M = "/oo3d/src/class-main.litcoffee Main:read()\n  ";
      return this._all[target].read(format);
    };

    Main.prototype.edit = function(target, set, delta) {
      var M;
      M = "/oo3d/src/class-main.litcoffee Main:edit()\n  ";
      this._all[target].edit(set, delta);
      return this;
    };

    Main.prototype.add = function(className, config) {
      var M, base, child, index, k, lut, parts;
      M = "/oo3d/src/class-main.litcoffee Main:add()\n  ";
      index = this._all.length;
      if (ªS !== typeof className) {
        throw TypeError(M + "`className` is " + (ªtype(className)) + " not string");
      }
      parts = className.split('.');
      if (2 !== parts.length) {
        throw RangeError(M + "`className` must be in 2 parts, not " + parts.length);
      }
      lut = {
        'Buffer': Buffer,
        'Item': Item,
        'Layer': Layer,
        'Program': Program,
        'Renderer': Renderer
      };
      base = lut[parts[0]];
      if (!base) {
        throw RangeError(M + "`className` base must be '" + (((function() {
          var results;
          results = [];
          for (k in lut) {
            results.push(k);
          }
          return results;
        })()).join('|')) + "'");
      }
      child = base[parts[1]];
      if (!child) {
        throw RangeError(M + "For `className` '" + parts[0] + "' use '" + (((function() {
          var results;
          results = [];
          for (k in base) {
            results.push(k);
          }
          return results;
        })()).join('|')) + "'");
      }
      this._all[index] = new child(this, index, config);
      if ('Layer' === parts[0]) {
        this.layers.push(this._all[index]);
      }
      return index;
    };

    Main.prototype["delete"] = function(targets) {
      var M, tTargets;
      M = "/oo3d/src/class-main.litcoffee Main:delete()\n  ";
      tTargets = typeof targets;
      if (ªN === tTargets) {
        if (ªMAX < targets || targets % 1 || 0 > targets) {
          throw RangeError(M + "`targets` is " + targets + " not 0 or a positive integer below 2^53");
        }
        if (!this._all[targets]) {
          throw TypeError(M + "`_all[" + targets + "]` does not exist");
        }
        deleteOne(this, targets);
      } else {
        throw TypeError(M + "`targets` is " + (ªtype(targets)) + " not number|string|array");
      }
      return this;
    };

    Main.prototype.rotate = function(x, y, z, targetIndex) {
      var c, m00, m01, m02, m03, m10, m11, m12, m13, m20, m21, m22, m23, mat, s, target, x0, y0, z0;
      target = this.meshes[targetIndex] || this.cameras[0];
      mat = target.mT;
      x0 = 0 === x;
      y0 = 0 === y;
      z0 = 0 === z;
      if (x0 && y0 && z0) {
        return this;
      } else if (y0 && z0) {
        s = Math.sin(x);
        c = Math.cos(x);
        m10 = mat[4];
        m11 = mat[5];
        m12 = mat[6];
        m13 = mat[7];
        m20 = mat[8];
        m21 = mat[9];
        m22 = mat[10];
        m23 = mat[11];
        mat[4] = m10 * c + m20 * s;
        mat[5] = m11 * c + m21 * s;
        mat[6] = m12 * c + m22 * s;
        mat[7] = m13 * c + m23 * s;
        mat[8] = m20 * c - m10 * s;
        mat[9] = m21 * c - m11 * s;
        mat[10] = m22 * c - m12 * s;
        mat[11] = m23 * c - m13 * s;
        target.rX += x;
      } else if (x0 && z0) {
        s = Math.sin(y);
        c = Math.cos(y);
        m00 = mat[0];
        m01 = mat[1];
        m02 = mat[2];
        m03 = mat[3];
        m20 = mat[8];
        m21 = mat[9];
        m22 = mat[10];
        m23 = mat[11];
        mat[0] = m00 * c - m20 * s;
        mat[1] = m01 * c - m21 * s;
        mat[2] = m02 * c - m22 * s;
        mat[3] = m03 * c - m23 * s;
        mat[8] = m00 * s + m20 * c;
        mat[9] = m01 * s + m21 * c;
        mat[10] = m02 * s + m22 * c;
        mat[11] = m03 * s + m23 * c;
        target.rY += y;
      } else if (x0 && y0) {
        s = Math.sin(z);
        c = Math.cos(z);
        m00 = mat[0];
        m01 = mat[1];
        m02 = mat[2];
        m03 = mat[3];
        m10 = mat[4];
        m11 = mat[5];
        m12 = mat[6];
        m13 = mat[7];
        mat[0] = m00 * c + m10 * s;
        mat[1] = m01 * c + m11 * s;
        mat[2] = m02 * c + m12 * s;
        mat[3] = m03 * c + m13 * s;
        mat[4] = m10 * c - m00 * s;
        mat[5] = m11 * c - m01 * s;
        mat[6] = m12 * c - m02 * s;
        mat[7] = m13 * c - m03 * s;
        target.rZ += z;
      } else {
        this.rotate(x, 0, 0, targetIndex);
        this.rotate(0, y, 0, targetIndex);
        this.rotate(0, 0, z, targetIndex);
      }
      if (target === this.cameras[0]) {
        this.cameras[0].updateCamera();
      }
      return this;
    };

    Main.prototype.scale = function(x, y, z, targetIndex) {
      var mat, target, x1, y1, z1;
      target = this.meshes[targetIndex] || this.cameras[0];
      mat = target.mT;
      x1 = 1 === x;
      y1 = 1 === y;
      z1 = 1 === z;
      if (!x1) {
        mat[0] *= x;
        mat[1] *= x;
        mat[2] *= x;
        mat[3] *= x;
        target.sX *= x;
      }
      if (!y1) {
        mat[4] *= y;
        mat[5] *= y;
        mat[6] *= y;
        mat[7] *= y;
        target.sY *= y;
      }
      if (!z1) {
        mat[8] *= z;
        mat[9] *= z;
        mat[10] *= z;
        mat[11] *= z;
        target.sZ *= z;
      }
      if (target === this.cameras[0]) {
        this.cameras[0].updateCamera();
      }
      return this;
    };

    Main.prototype.translate = function(x, y, z, targetIndex) {
      var mat, target, x0, y0, z0;
      target = this.meshes[targetIndex] || this.cameras[0];
      mat = target.mT;
      x0 = 0 === x;
      y0 = 0 === y;
      z0 = 0 === z;
      if (x0 && y0 && z0) {
        return this;
      } else if (y0 && z0) {
        mat[12] += mat[0] * x;
        mat[13] += mat[1] * x;
        mat[14] += mat[2] * x;
        mat[15] += mat[3] * x;
        target.tX += x;
      } else if (x0 && z0) {
        mat[12] += mat[4] * y;
        mat[13] += mat[5] * y;
        mat[14] += mat[6] * y;
        mat[15] += mat[7] * y;
        target.tY += y;
      } else if (x0 && y0) {
        mat[12] += mat[8] * z;
        mat[13] += mat[9] * z;
        mat[14] += mat[10] * z;
        mat[15] += mat[11] * z;
        target.tZ += z;
      } else {
        mat[12] += mat[0] * x + mat[4] * y + mat[8] * z;
        mat[13] += mat[1] * x + mat[5] * y + mat[9] * z;
        mat[14] += mat[2] * x + mat[6] * y + mat[10] * z;
        mat[15] += mat[3] * x + mat[7] * y + mat[11] * z;
        target.tX += x;
        target.tY += y;
        target.tZ += z;
      }
      if (target === this.cameras[0]) {
        this.cameras[0].updateCamera();
      }
      return this;
    };

    Main.prototype.resetTransform = function(targetIndex) {
      var mat, target;
      target = this.meshes[targetIndex] || this.cameras[0];
      mat = target.mT;
      target.rX = target.rY = target.rZ = 0;
      target.sX = target.sY = target.sZ = 1;
      target.tX = target.tY = target.tZ = 0;
      target.mT = new Float32Array([1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1]);
      if (target === this.cameras[0]) {
        this.cameras[0].tZ = -4;
        this.cameras[0].mT[14] = -4;
        this.cameras[0].updateCamera();
      }
      return this;
    };

    Main.prototype.setRenderMode = function(renderMode, targetIndex) {
      if (!this._all[targetIndex]) {
        return;
      }
      this._all[targetIndex].renderMode = renderMode;
      return this;
    };

    Main.prototype.getColorAt = function(x, y) {
      var pixels;
      pixels = new Uint8Array(4);
      this.gl.readPixels(x, y, 1, 1, this.gl.RGBA, this.gl.UNSIGNED_BYTE, pixels);
      return pixels;
    };

    Main.prototype.getMeshIByColor = function(color) {
      var index;
      index = pick.colorToIndex(color);
      return index;
    };

    Main.prototype.getCameraSnapshot = function(cameraI) {
      var camera, mat;
      camera = this.cameras[cameraI];
      mat = new Float32Array(16);
      mat.set(camera.mT);
      return {
        mat: mat,
        rX: camera.rX,
        rY: camera.rY,
        rZ: camera.rZ,
        sX: camera.sX,
        sY: camera.sY,
        sZ: camera.sZ,
        tX: camera.tX,
        tY: camera.tY,
        tZ: camera.tZ
      };
    };

    Main.prototype.getMeshSnapshot = function(meshI) {
      var item, mat;
      item = this.meshes[meshI];
      mat = new Float32Array(16);
      mat.set(item.mT);
      return {
        mat: mat,
        rX: item.rX,
        rY: item.rY,
        rZ: item.rZ,
        sX: item.sX,
        sY: item.sY,
        sZ: item.sZ,
        tX: item.tX,
        tY: item.tY,
        tZ: item.tZ
      };
    };

    Main.prototype.setCameraSnapshot = function(snapshot, cameraI) {
      var camera;
      camera = this.cameras[cameraI];
      camera.mT = new Float32Array(16);
      camera.mT.set(snapshot.mat);
      camera.rX = snapshot.rX;
      camera.rY = snapshot.rY;
      camera.rZ = snapshot.rZ;
      camera.sX = snapshot.sX;
      camera.sY = snapshot.sY;
      camera.sZ = snapshot.sZ;
      camera.tX = snapshot.tX;
      camera.tY = snapshot.tY;
      camera.tZ = snapshot.tZ;
      return this;
    };

    Main.prototype.setMeshSnapshot = function(snapshot, meshI) {
      var item;
      item = this.meshes[meshI];
      item.mT = new Float32Array(16);
      item.mT.set(snapshot.mat);
      item.rX = snapshot.rX;
      item.rY = snapshot.rY;
      item.rZ = snapshot.rZ;
      item.sX = snapshot.sX;
      item.sY = snapshot.sY;
      item.sZ = snapshot.sZ;
      item.tX = snapshot.tX;
      item.tY = snapshot.tY;
      item.tZ = snapshot.tZ;
      return this;
    };

    Main.prototype.render = function() {
      var j, layer, len, ref;
      if (!this.gl) {
        throw Error("The WebGL rendering context is " + (ªtype(this.gl)));
      }
      this.gl.clearColor(this.bkgndR, this.bkgndG, this.bkgndB, this.bkgndA);
      this.gl.scissor(0, 0, this.$main.width, this.$main.height);
      this.gl.clear(this.gl.COLOR_BUFFER_BIT | this.gl.DEPTH_BUFFER_BIT);
      ref = this.layers;
      for (j = 0, len = ref.length; j < len; j++) {
        layer = ref[j];
        layer.render();
      }
      return this;
    };

    deleteOne = function(main, targetI) {
      var classParts, instance, j, l, layer, len, len1, len2, len3, mesh, o, q, ref, ref1, ref2, ref3, renderer;
      instance = main._all[targetI];
      classParts = instance.C.split('.');
      switch (classParts[0]) {
        case 'Buffer':
          ref = main._all;
          for (j = 0, len = ref.length; j < len; j++) {
            mesh = ref[j];
            if (mesh && (mesh instanceof Item.Mesh)) {
              mesh["delete"](targetI);
            }
          }
          break;
        case 'Item':
        case 'Program':
          ref1 = main._all;
          for (l = 0, len1 = ref1.length; l < len1; l++) {
            renderer = ref1[l];
            if (renderer && (renderer instanceof Renderer)) {
              renderer["delete"](targetI, classParts);
            }
          }
          break;
        case 'Renderer':
          ref2 = main.layers;
          for (o = 0, len2 = ref2.length; o < len2; o++) {
            layer = ref2[o];
            layer["delete"](targetI);
          }
          break;
        case 'Layer':
          ref3 = main.layers;
          for (q = 0, len3 = ref3.length; q < len3; q++) {
            layer = ref3[q];
            1;
          }
      }
      instance["delete"]();
      return delete main._all[targetI];
    };

    return Main;

  })();

  if (ªF === typeof define && define.amd) {
    define(function() {
      return Main;
    });
  } else if (ªO === typeof module && module && module.exports) {
    module.exports = Main;
  } else {
    ªW[ªC] = Main;
  }

  if (ªF === typeof define && define.amd) {

  } else if (ªO === typeof module && module && module.exports) {
    Nwang = require('nwang');
  } else {
    Nwang = window.Nwang;
  }

  mat4 = {};

  mat4.multiply = function(a, b) {
    var a00, a01, a02, a03, a10, a11, a12, a13, a20, a21, a22, a23, a30, a31, a32, a33, b0, b1, b2, b3, out;
    out = new Float32Array(16);
    a00 = a[0];
    a01 = a[1];
    a02 = a[2];
    a03 = a[3];
    a10 = a[4];
    a11 = a[5];
    a12 = a[6];
    a13 = a[7];
    a20 = a[8];
    a21 = a[9];
    a22 = a[10];
    a23 = a[11];
    a30 = a[12];
    a31 = a[13];
    a32 = a[14];
    a33 = a[15];
    b0 = b[0];
    b1 = b[1];
    b2 = b[2];
    b3 = b[3];
    out[0] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;
    out[1] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;
    out[2] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;
    out[3] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;
    b0 = b[4];
    b1 = b[5];
    b2 = b[6];
    b3 = b[7];
    out[4] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;
    out[5] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;
    out[6] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;
    out[7] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;
    b0 = b[8];
    b1 = b[9];
    b2 = b[10];
    b3 = b[11];
    out[8] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;
    out[9] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;
    out[10] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;
    out[11] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;
    b0 = b[12];
    b1 = b[13];
    b2 = b[14];
    b3 = b[15];
    out[12] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;
    out[13] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;
    out[14] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;
    out[15] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;
    return out;
  };

  mat4.perspective = function(fovy, aspect, near, far) {
    var f, nf, out;
    f = 1.0 / Math.tan(fovy / 2);
    nf = 1 / (near - far);
    out = new Float32Array(16);
    out[0] = f / aspect;
    out[1] = 0;
    out[2] = 0;
    out[3] = 0;
    out[4] = 0;
    out[5] = f;
    out[6] = 0;
    out[7] = 0;
    out[8] = 0;
    out[9] = 0;
    out[10] = (far + near) * nf;
    out[11] = -1;
    out[12] = 0;
    out[13] = 0;
    out[14] = (2 * far * near) * nf;
    out[15] = 0;
    return out;
  };

  mat4.rotateX = function(a, rad) {
    var a10, a11, a12, a13, a20, a21, a22, a23, c, s;
    s = Math.sin(rad);
    c = Math.cos(rad);
    a10 = a[4];
    a11 = a[5];
    a12 = a[6];
    a13 = a[7];
    a20 = a[8];
    a21 = a[9];
    a22 = a[10];
    a23 = a[11];
    a[4] = a10 * c + a20 * s;
    a[5] = a11 * c + a21 * s;
    a[6] = a12 * c + a22 * s;
    a[7] = a13 * c + a23 * s;
    a[8] = a20 * c - a10 * s;
    a[9] = a21 * c - a11 * s;
    a[10] = a22 * c - a12 * s;
    a[11] = a23 * c - a13 * s;
    return a;
  };

  mat4.rotateY = function(a, rad) {
    var a00, a01, a02, a03, a20, a21, a22, a23, c, s;
    s = Math.sin(rad);
    c = Math.cos(rad);
    a00 = a[0];
    a01 = a[1];
    a02 = a[2];
    a03 = a[3];
    a20 = a[8];
    a21 = a[9];
    a22 = a[10];
    a23 = a[11];
    a[0] = a00 * c - a20 * s;
    a[1] = a01 * c - a21 * s;
    a[2] = a02 * c - a22 * s;
    a[3] = a03 * c - a23 * s;
    a[8] = a00 * s + a20 * c;
    a[9] = a01 * s + a21 * c;
    a[10] = a02 * s + a22 * c;
    a[11] = a03 * s + a23 * c;
    return a;
  };

  mat4.rotateZ = function(a, rad) {
    var a00, a01, a02, a03, a10, a11, a12, a13, c, s;
    s = Math.sin(rad);
    c = Math.cos(rad);
    a00 = a[0];
    a01 = a[1];
    a02 = a[2];
    a03 = a[3];
    a10 = a[4];
    a11 = a[5];
    a12 = a[6];
    a13 = a[7];
    a[0] = a00 * c + a10 * s;
    a[1] = a01 * c + a11 * s;
    a[2] = a02 * c + a12 * s;
    a[3] = a03 * c + a13 * s;
    a[4] = a10 * c - a00 * s;
    a[5] = a11 * c - a01 * s;
    a[6] = a12 * c - a02 * s;
    a[7] = a13 * c - a03 * s;
    return a;
  };

  mat4.translate = function(a, x, y, z) {
    a[12] = a[0] * x + a[4] * y + a[8] * z + a[12];
    a[13] = a[1] * x + a[5] * y + a[9] * z + a[13];
    a[14] = a[2] * x + a[6] * y + a[10] * z + a[14];
    a[15] = a[3] * x + a[7] * y + a[11] * z + a[15];
    return a;
  };

  mat4.ortho = function(left, right, bottom, top, near, far) {
    var bt, lr, nf, out;
    lr = 1 / (left - right);
    bt = 1 / (bottom - top);
    nf = 1 / (near - far);
    out = new Float32Array(16);
    out[0] = -2 * lr;
    out[1] = 0;
    out[2] = 0;
    out[3] = 0;
    out[4] = 0;
    out[5] = -2 * bt;
    out[6] = 0;
    out[7] = 0;
    out[8] = 0;
    out[9] = 0;
    out[10] = 2 * nf;
    out[11] = 0;
    out[12] = (left + right) * lr;
    out[13] = (top + bottom) * bt;
    out[14] = (far + near) * nf;
    out[15] = 1;
    return out;
  };

  mat4.makeTranslation = function(tx, ty, tz) {
    return new Float32Array([1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, tx, ty, tz, 1]);
  };

  mat4.makeXRotation = function(angleInRadians) {
    var c, s;
    c = Math.cos(angleInRadians);
    s = Math.sin(angleInRadians);
    return new Float32Array([1, 0, 0, 0, 0, c, s, 0, 0, -s, c, 0, 0, 0, 0, 1]);
  };

  mat4.makeYRotation = function(angleInRadians) {
    var c, s;
    c = Math.cos(angleInRadians);
    s = Math.sin(angleInRadians);
    return new Float32Array([c, 0, -s, 0, 0, 1, 0, 0, s, 0, c, 0, 0, 0, 0, 1]);
  };

  mat4.makeZRotation = function(angleInRadians) {
    var c, s;
    c = Math.cos(angleInRadians);
    s = Math.sin(angleInRadians);
    return new Float32Array([c, s, 0, 0, -s, c, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1]);
  };

  mat4.makeScale = function(sx, sy, sz) {
    return new Float32Array([sx, 0, 0, 0, 0, sy, 0, 0, 0, 0, sz, 0, 0, 0, 0, 1]);
  };

  mat4.makeProjection = function(width, height, depth) {
    return new Float32Array([2 / width, 0, 0, 0, 0, -2 / height, 0, 0, 0, 0, 2 / depth, 0, -1, 1, 0, 1]);
  };

  pick = {};

  pick.indexToColor = function(index) {
    var b, g, i, r;
    i = ('00000000000000000000000' + index.toString(2)).slice(-24).split('');
    r = "" + i[23] + i[20] + i[17] + i[14] + i[11] + i[8] + i[5] + i[2];
    g = "" + i[22] + i[19] + i[16] + i[13] + i[10] + i[7] + i[4] + i[1];
    b = "" + i[21] + i[18] + i[15] + i[12] + i[9] + i[6] + i[3] + i[0];
    return new Float32Array([parseInt(r, 2) / 255, parseInt(g, 2) / 255, parseInt(b, 2) / 255, 1.0]);
  };

  pick.colorToIndex = function(color) {
    var b, g, i, r;
    r = ('0000000' + color[0].toString(2)).slice(-8).split('');
    g = ('0000000' + color[1].toString(2)).slice(-8).split('');
    b = ('0000000' + color[2].toString(2)).slice(-8).split('');
    i = ("" + b[7] + g[7] + r[7]) + ("" + b[6] + g[6] + r[6]) + ("" + b[5] + g[5] + r[5]) + ("" + b[4] + g[4] + r[4]) + ("" + b[3] + g[3] + r[3]) + ("" + b[2] + g[2] + r[2]) + ("" + b[1] + g[1] + r[1]) + ("" + b[0] + g[0] + r[0]);
    return parseInt(i, 2);
  };

  pick.qikColorToIndex = function(color) {
    var b, g, i, r;
    r = (color[0].toString(2)).split('');
    g = (color[1].toString(2)).split('');
    b = (color[2].toString(2)).split('');
    i = ("" + (b[2] || 0) + (g[2] || 0) + (r[2] || 0)) + ("" + (b[1] || 0) + (g[1] || 0) + (r[1] || 0)) + ("" + b[0] + g[0] + r[0]);
    return parseInt(i, 2);
  };

  uri = {};

  uri.r2Tenmin = function(r) {
    return Math.round(r * uri.RESOLUTION_R);
  };

  uri.tenmin2r = function(r) {
    return r / uri.RESOLUTION_R;
  };

  uri.r2uri = function(radians) {
    var PI2, c1, c1i, c2, c2i, tenmin;
    PI2 = Math.PI * 2;
    radians = radians % PI2;
    if (0 > radians) {
      radians += PI2;
    }
    tenmin = uri.r2Tenmin(radians);
    c1 = uri.USUAL_R2URI[tenmin];
    if (c1) {
      return c1;
    }
    c1i = tenmin % 36;
    c2i = (tenmin - c1i) / 36;
    c1 = "0123456789abcdefghijklmnopqrstuvwxyz"[c1i];
    c2 = "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWX"[c2i];
    return '' + c1 + c2;
  };

  uri.s2uri = function(s) {
    var c1, c2, c3, m, n, nM64, neg;
    if (0 > s) {
      neg = true;
      s = Math.abs(s);
    }
    if (0.0001 > s) {
      return 'A';
    }
    if (0.001 > s) {
      m = neg ? 'a' : 'p';
      n = s * 10000000;
    } else if (0.01 > s) {
      m = neg ? 'b' : 'o';
      n = s * 1000000;
    } else if (0.1 > s) {
      m = neg ? 'c' : 'n';
      n = s * 100000;
    } else if (1 > s) {
      m = neg ? 'd' : 'm';
      n = s * 10000;
    } else if (10 > s) {
      m = neg ? 'e' : 'l';
      n = s * 1000;
    } else if (100 > s) {
      m = neg ? 'f' : 'k';
      n = s * 100;
    } else if (1000 > s) {
      m = neg ? 'g' : 'j';
      n = s * 10;
    } else if (10000 > s) {
      m = neg ? 'h' : 'i';
      n = s;
    } else {
      return 'Z';
    }
    n = n / 4;
    n = Math.floor(n);
    c1 = uri.USUAL_S2URI[m + n];
    if (c1) {
      return c1;
    }
    nM64 = n % 64;
    c1 = m;
    c2 = "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-"[nM64];
    c3 = "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-"[(n - nM64) / 64];
    if (ªU === typeof c1 || ªU === typeof c2 || ªU === typeof c3) {
      ª('UNDEFINED RESULT s2uri(' + s + ')', n, nM64, (n - nM64) / 64, '' + c1 + c2 + c3);
    }
    return c1 + c2 + c3;
  };

  uri.t2uri = function(t) {
    var c1, c2, c3, m, n, nM64, neg;
    if (0 > t) {
      neg = true;
      t = Math.abs(t);
    }
    if (0.0001 > t) {
      return 'A';
    }
    if (0.001 > t) {
      m = neg ? 'a' : 'p';
      n = t * 10000000;
    } else if (0.01 > t) {
      m = neg ? 'b' : 'o';
      n = t * 1000000;
    } else if (0.1 > t) {
      m = neg ? 'c' : 'n';
      n = t * 100000;
    } else if (1 > t) {
      m = neg ? 'd' : 'm';
      n = t * 10000;
    } else if (10 > t) {
      m = neg ? 'e' : 'l';
      n = t * 1000;
    } else if (100 > t) {
      m = neg ? 'f' : 'k';
      n = t * 100;
    } else if (1000 > t) {
      m = neg ? 'g' : 'j';
      n = t * 10;
    } else if (10000 > t) {
      m = neg ? 'h' : 'i';
      n = t;
    } else {
      return 'Z';
    }
    n = n / 4;
    n = Math.floor(n);
    c1 = uri.USUAL_T2URI[m + n];
    if (c1) {
      return c1;
    }
    nM64 = n % 64;
    c1 = m;
    c2 = "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-"[nM64];
    c3 = "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-"[(n - nM64) / 64];
    if (ªU === typeof c1 || ªU === typeof c2 || ªU === typeof c3) {
      ª('UNDEFINED RESULT t2uri(' + t + ')', n, nM64, (n - nM64) / 64, '' + c1 + c2 + c3);
    }
    return c1 + c2 + c3;
  };

  uri.uri2r = function(str) {
    var c1, c2, usual;
    usual = uri.USUAL_URI2R[str];
    if (ªN === typeof usual) {
      return uri.tenmin2r(usual);
    }
    c1 = uri.B64DECODE[str[0]];
    c2 = uri.B64DECODE[str[1]];
    return uri.tenmin2r(c1 * 60 + c2);
  };

  uri.uri2s = function(str) {
    var c1, c2, c3, usual;
    usual = uri.USUAL_URI2S[str];
    if (ªN === typeof usual) {
      return usual;
    }
    c1 = uri.MULTIPLIER[str[0]];
    c2 = uri.B64DECODE[str[1]];
    c3 = uri.B64DECODE[str[2]];
    return c1 * (c2 + c3 * 64 * 4);
  };

  uri.uri2t = function(str) {
    var c1, c2, c3, usual;
    usual = uri.USUAL_URI2T[str];
    if (ªN === typeof usual) {
      return usual;
    }
    c1 = uri.MULTIPLIER[str[0]];
    c2 = uri.B64DECODE[str[1]];
    c3 = uri.B64DECODE[str[2]];
    return c1 * (c2 + c3 * 64 * 4);
  };

  uri.RESOLUTION_R = 1 / (Math.PI * 2 / 36 / 60);

  uri.USUAL_R2URI = (function() {
    var PI, out;
    PI = Math.PI;
    out = {};
    out[0] = 'A';
    out[uri.r2Tenmin(PI / 6.0)] = 'B';
    out[uri.r2Tenmin(PI / 4.0)] = 'C';
    out[uri.r2Tenmin(PI / 3.0)] = 'D';
    out[uri.r2Tenmin(PI * 0.5)] = 'E';
    out[uri.r2Tenmin(PI / 1.5)] = 'F';
    out[uri.r2Tenmin(PI * 0.75)] = 'G';
    out[uri.r2Tenmin(PI / 1.2)] = 'H';
    out[uri.r2Tenmin(PI)] = 'I';
    out[uri.r2Tenmin(PI / 6.0 + PI)] = 'J';
    out[uri.r2Tenmin(PI / 4.0 + PI)] = 'K';
    out[uri.r2Tenmin(PI / 3.0 + PI)] = 'L';
    out[uri.r2Tenmin(PI * 1.5)] = 'M';
    out[uri.r2Tenmin(PI / 1.5 + PI)] = 'N';
    out[uri.r2Tenmin(PI * 1.75)] = 'O';
    out[uri.r2Tenmin(PI / 1.2 + PI)] = 'P';
    out[uri.r2Tenmin(PI * 2.0)] = 'Q';
    return out;
  })();

  uri.USUAL_URI2R = (function() {
    var key, out, ref, val;
    out = {};
    ref = uri.USUAL_R2URI;
    for (key in ref) {
      val = ref[key];
      out[val] = +key;
    }
    return out;
  })();

  uri.USUAL_S2URI = {
    d1250: 'C',
    d2500: 'D',
    d5000: 'E',
    e1000: 'F',
    e2000: 'G',
    e4000: 'H',
    e8000: 'I',
    m1250: 'R',
    m2500: 'S',
    m5000: 'T',
    l1000: 'U',
    l2000: 'V',
    l4000: 'W',
    l8000: 'X'
  };

  uri.USUAL_URI2S = {
    A: 0,
    C: -0.125,
    D: -0.25,
    E: -0.5,
    F: -1,
    G: -2,
    H: -4,
    I: -8,
    R: 0.125,
    S: 0.25,
    T: 0.5,
    U: 1,
    V: 2,
    W: 4,
    X: 8,
    Z: 10000
  };

  uri.USUAL_T2URI = {
    d1250: 'C',
    d2500: 'D',
    d5000: 'E',
    e1000: 'F',
    e2000: 'G',
    e4000: 'H',
    e8000: 'I',
    m1250: 'R',
    m2500: 'S',
    m5000: 'T',
    l1000: 'U',
    l2000: 'V',
    l4000: 'W',
    l8000: 'X'
  };

  uri.USUAL_URI2T = {
    A: 0,
    C: -0.125,
    D: -0.25,
    E: -0.5,
    F: -1,
    G: -2,
    H: -4,
    I: -8,
    R: 0.125,
    S: 0.25,
    T: 0.5,
    U: 1,
    V: 2,
    W: 4,
    X: 8,
    Z: 10000
  };

  uri.MULTIPLIER = {
    a: -1 / 10000000,
    b: -1 / 1000000,
    c: -1 / 100000,
    d: -1 / 10000,
    e: -1 / 1000,
    f: -1 / 100,
    g: -1 / 10,
    h: -1,
    p: 1 / 10000000,
    o: 1 / 1000000,
    n: 1 / 100000,
    m: 1 / 10000,
    l: 1 / 1000,
    k: 1 / 100,
    j: 1 / 10,
    i: 1
  };

  uri.B64DECODE = (function() {
    var b64, i, j, out;
    out = {};
    b64 = "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-";
    for (i = j = 0; j <= 63; i = ++j) {
      out[b64[i]] = i;
    }
    return out;
  })();

  Buffer = (function() {
    Buffer.prototype.C = 'Buffer';

    Buffer.prototype.toString = function() {
      return '[object Buffer]';
    };

    function Buffer(main1, index1, config) {
      var M, gl, tData;
      this.main = main1;
      this.index = index1;
      if (config == null) {
        config = {};
      }
      M = "/oo3d/src/buffer/base-buffer.litcoffee Buffer#" + (+this.index) + "()\n  ";
      if (ªO !== ªtype(config)) {
        throw TypeError(M + "Optional `config` is " + (ªtype(config)) + " not object");
      }
      if (ªO !== typeof this.main) {
        throw TypeError(M + "`main` is " + (ªtype(this.main)) + " not object");
      }
      if ('[object Oo3d]' !== '' + this.main) {
        throw TypeError(M + "`main` is '" + this.main + "' not '[object Oo3d]'");
      }
      if (ªN !== typeof this.index) {
        throw TypeError(M + "`index` is " + (ªtype(this.index)) + " not number");
      }
      if (ªMAX < this.index || this.index % 1 || 0 > this.index) {
        throw RangeError(M + "`index` is " + this.index + " not 0 or a positive integer below 2^53");
      }
      gl = this.main.gl;
      this.glData = gl.createBuffer();
      gl.bindBuffer(gl.ARRAY_BUFFER, this.glData);
      tData = ªtype(config.data);
      if (ªU === tData) {
        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([]), gl.STATIC_DRAW);
      } else {
        if (ªA !== tData) {
          throw TypeError(M + "`config.data` is " + tData + " not array");
        }
        if (config.data.some(isNaN)) {
          throw TypeError(M + "`config.data` contains a non-numeric value");
        }
        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(config.data), gl.STATIC_DRAW);
      }
    }

    Buffer.prototype.browse = function() {};

    return Buffer;

  })();

  Buffer.Color = (function(superClass) {
    extend(Color, superClass);

    Color.prototype.C = 'Buffer.Color';

    Color.prototype.toString = function() {
      return '[object Buffer.Color]';
    };

    function Color(main, index, config) {
      var M;
      if (config == null) {
        config = {};
      }
      M = "/oo3d/src/buffer/class-buffer-color.litcoffee Buffer.Color#" + (+index) + "()\n  ";
      Color.__super__.constructor.call(this, main, index, config);
      if (ªU === typeof config.data) {
        this.count = 0;
      } else {
        if (config.data.length % 4) {
          throw RangeError(M + "`config.data.length` " + config.data.length + " not divisible by 4");
        }
        this.count = config.data.length / 4;
      }
    }

    Color.prototype.browse = function() {};

    return Color;

  })(Buffer);

  Buffer.Position = (function(superClass) {
    extend(Position, superClass);

    Position.prototype.C = 'Buffer.Position';

    Position.prototype.toString = function() {
      return '[object Buffer.Position]';
    };

    function Position(main, index, config) {
      var M;
      if (config == null) {
        config = {};
      }
      M = "/oo3d/src/buffer/class-buffer-position.litcoffee Buffer.Position#" + (+index) + "()\n  ";
      Position.__super__.constructor.call(this, main, index, config);
      if (ªU === typeof config.data) {
        this.count = 0;
      } else {
        if (config.data.length % 3) {
          throw RangeError(M + "`config.data.length` " + config.data.length + " not divisible by 3");
        }
        this.count = config.data.length / 3;
      }
    }

    Position.prototype.browse = function() {};

    return Position;

  })(Buffer);

  Item = (function() {
    var xx;

    Item.prototype.C = 'Item';

    Item.prototype.toString = function() {
      return '[object Item]';
    };

    function Item(main1, index1, config) {
      var M;
      this.main = main1;
      this.index = index1;
      if (config == null) {
        config = {};
      }
      M = "/oo3d/src/item/base-item.litcoffee Item#" + (+this.index) + "()\n  ";
      if (ªO !== ªtype(config)) {
        throw TypeError(M + "Optional `config` is " + (ªtype(config)) + " not object");
      }
      if (ªO !== typeof this.main) {
        throw TypeError(M + "`main` is " + (ªtype(this.main)) + " not object");
      }
      if ('[object Oo3d]' !== '' + this.main) {
        throw TypeError(M + "`main` is '" + this.main + "' not '[object Oo3d]'");
      }
      if (ªN !== typeof this.index) {
        throw TypeError(M + "`index` is " + (ªtype(this.index)) + " not number");
      }
      if (ªMAX < this.index || this.index % 1 || 0 > this.index) {
        throw RangeError(M + "`index` is " + this.index + " not 0 or a positive integer below 2^53");
      }
      this.oT = config.oT || 'trs';
      if (!{
        'trs': 1,
        'rts': 1,
        'srt': 1
      }[this.oT]) {
        throw RangeError(M + "Optional `config.oT` is not 'trs|rts|srt'");
      }
      this.mT = new Float32Array([1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1]);
      this.rX = 0;
      this.rY = 0;
      this.rZ = 0;
      this.sX = 1;
      this.sY = 1;
      this.sZ = 1;
      this.tX = 0;
      this.tY = 0;
      this.tZ = 0;
    }

    Item.prototype.browse = function(search) {
      var M;
      M = "/oo3d/src/item/base-item.litcoffee Item#" + this.index + ":browse()\n  ";
      return [];
    };

    Item.prototype.read = function(format) {
      var M, mT, mTCopy, sf3;
      M = "/oo3d/src/item/base-item.litcoffee Item#" + this.index + ":read()\n  ";
      if (ªU === typeof format || 'object' === format) {
        mTCopy = new Float32Array(16);
        mTCopy.set(this.mT);
        return {
          index: this.index,
          mT: mTCopy,
          rX: this.rX,
          rY: this.rY,
          rZ: this.rZ,
          sX: this.sX,
          sY: this.sY,
          sZ: this.sZ,
          tX: this.tX,
          tY: this.tY,
          tZ: this.tZ
        };
      } else if ('log' === format) {
        mT = this.mT;
        return "i " + this.index + " mT " + mT[0] + " " + mT[1] + " " + mT[2] + " " + mT[3] + " " + mT[4] + " " + mT[5] + " " + mT[6] + " " + mT[7] + " " + mT[8] + " " + mT[9] + " " + mT[10] + " " + mT[11] + " " + mT[12] + " " + mT[13] + " " + mT[14] + " " + mT[15] + " r " + this.rX + " " + this.rY + " " + this.rZ + " s " + this.sX + " " + this.sY + " " + this.sZ + " t " + this.tX + " " + this.tY + " " + this.tZ;
      } else if ('nwang' === format) {
        mT = this.mT;
        sf3 = this.main.nwang.sf3;
        return ("" + (sf3(this.index))) + ("" + (sf3(mT[0])) + (sf3(mT[1])) + (sf3(mT[2])) + (sf3(mT[3]))) + ("" + (sf3(mT[4])) + (sf3(mT[5])) + (sf3(mT[6])) + (sf3(mT[7]))) + ("" + (sf3(mT[8])) + (sf3(mT[9])) + (sf3(mT[10])) + (sf3(mT[11]))) + ("" + (sf3(mT[12])) + (sf3(mT[13])) + (sf3(mT[14])) + (sf3(mT[15]))) + ("" + (sf3(this.rX)) + (sf3(this.rY)) + (sf3(this.rZ))) + ("" + (sf3(this.sX)) + (sf3(this.sY)) + (sf3(this.sZ))) + ("" + (sf3(this.tX)) + (sf3(this.tY)) + (sf3(this.tZ)));
      } else if (ªS === typeof format) {
        throw RangeError(M + "Optional `format` is not 'object|log|nwang'");
      } else {
        throw TypeError(M + "Optional `format` is " + (ªtype(format)) + " not string|object");
      }
    };

    Item.prototype.edit = function(set, delta) {
      var M, a, a00, a01, a02, a03, a10, a11, a12, a13, a20, a21, a22, a23, char, chars, i, j, key, keys, l, len, len1, len2, len3, len4, o, q, rXc, rXs, rYc, rYs, rZc, rZs, ref, ref1, ref2, ref3, ref4, ref5, ref6, ref7, ref8, sf3, stale, tDelta, tMT, tSet, tVal, tmp, u, val, vals;
      M = "/oo3d/src/item/base-item.litcoffee Item#" + this.index + ":edit()\n  ";
      tSet = ªtype(set);
      tDelta = ªtype(delta);
      tmp = {};
      stale = false;
      if (ªU === tSet || ªX === tSet) {
        ref = ['rX', 'rY', 'rZ', 'sX', 'sY', 'sZ', 'tX', 'tY', 'tZ'];
        for (j = 0, len = ref.length; j < len; j++) {
          key = ref[j];
          tmp[key] = this[key];
        }
      } else {
        if (ªO === tSet) {
          if (ªU !== typeof set.index && this.index !== set.index) {
            throw RangeError(M + "`this.index` cannot be altered by `set.index`");
          }
          ref1 = ['rX', 'rY', 'rZ', 'sX', 'sY', 'sZ', 'tX', 'tY', 'tZ'];
          for (l = 0, len1 = ref1.length; l < len1; l++) {
            key = ref1[l];
            val = set[key];
            tVal = typeof val;
            if (ªU === tVal) {
              tmp[key] = this[key];
            } else {
              if (ªN !== tVal) {
                throw TypeError(M + "`set." + key + "` is " + (ªtype(val)) + " not number");
              }
              if (isNaN(val)) {
                throw TypeError(M + "`set." + key + "` is NaN");
              }
              tmp[key] = val;
            }
          }
          if (set.mT) {
            tMT = ªtype(set.mT);
            if (ªA !== tMT.slice(-5)) {
              throw TypeError(M + "`set.TtM` is " + tMT + " not array|*Array");
            }
            if (16 !== set.mT.length) {
              throw RangeError(M + "`set.TtM` has " + set.mT.length + " elements not 16");
            }
            tmp.mT = new Float32Array(16);
            tmp.mT.set(set.mT);
          } else {
            stale = true;
          }
        } else if (ªS !== tSet) {
          throw TypeError(M + "Optional `set` is " + tSet + " not " + ªS + "|object");
        } else if ('reset' === set) {
          this.reset(tmp);
        } else if (0xAFE8 < set.charCodeAt(0)) {
          sf3 = this.main.nwang.sf3;
          if (9 === set.length) {
            ref2 = (function() {
              var len2, o, ref2, results;
              ref2 = set.split('');
              results = [];
              for (o = 0, len2 = ref2.length; o < len2; o++) {
                char = ref2[o];
                results.push(+sf3(char));
              }
              return results;
            })(), tmp.rX = ref2[0], tmp.rY = ref2[1], tmp.rZ = ref2[2], tmp.sX = ref2[3], tmp.sY = ref2[4], tmp.sZ = ref2[5], tmp.tX = ref2[6], tmp.tY = ref2[7], tmp.tZ = ref2[8];
            stale = true;
          } else if (26 === set.length) {
            chars = set.split('');
            if (this.index !== +sf3(chars[0])) {
              throw RangeError(M + "`this.index` cannot be altered by passing `set` an 'nwang'");
            }
            tmp.mT = new Float32Array((function() {
              var o, results;
              results = [];
              for (i = o = 1; o <= 16; i = ++o) {
                results.push(+sf3(chars[i]));
              }
              return results;
            })());
            ref3 = (function() {
              var o, results;
              results = [];
              for (i = o = 17; o <= 25; i = ++o) {
                results.push(+sf3(chars[i]));
              }
              return results;
            })(), tmp.rX = ref3[0], tmp.rY = ref3[1], tmp.rZ = ref3[2], tmp.sX = ref3[3], tmp.sY = ref3[4], tmp.sZ = ref3[5], tmp.tX = ref3[6], tmp.tY = ref3[7], tmp.tZ = ref3[8];
          } else {
            throw RangeError(M + "`set` appears to be 'nwang' but is " + set.length + " characters");
          }
        } else {
          vals = set.split(' ');
          if ('rst' === vals[0] + vals[4] + vals[8]) {
            ref4 = (function() {
              var len2, o, ref4, results;
              ref4 = [1, 2, 3, 5, 6, 7, 9, 10, 11];
              results = [];
              for (o = 0, len2 = ref4.length; o < len2; o++) {
                i = ref4[o];
                val = +vals[i];
                if (!isNaN(val)) {
                  results.push(val);
                } else {
                  throw RangeError(M + "`set` appears to be 9-char 'log' with non-numeric values");
                }
              }
              return results;
            })(), tmp.rX = ref4[0], tmp.rY = ref4[1], tmp.rZ = ref4[2], tmp.sX = ref4[3], tmp.sY = ref4[4], tmp.sZ = ref4[5], tmp.tX = ref4[6], tmp.tY = ref4[7], tmp.tZ = ref4[8];
            stale = true;
          } else if ('imTrst' === vals[0] + vals[2] + vals[19] + vals[23] + vals[27]) {
            if (this.index !== +vals[1]) {
              throw RangeError(M + "`this.index` cannot be altered by passing `set` a 'log'");
            }
            tmp.mT = new Float32Array((function() {
              var o, results;
              results = [];
              for (i = o = 3; o <= 18; i = ++o) {
                results.push(vals[i]);
              }
              return results;
            })());
            ref5 = (function() {
              var len2, o, ref5, results;
              ref5 = [20, 21, 22, 24, 25, 26, 28, 29, 30];
              results = [];
              for (o = 0, len2 = ref5.length; o < len2; o++) {
                i = ref5[o];
                val = +vals[i];
                if (!isNaN(val)) {
                  results.push(val);
                } else {
                  throw RangeError(M + "`set` appears to be 26-char 'log' with non-numeric values");
                }
              }
              return results;
            })(), tmp.rX = ref5[0], tmp.rY = ref5[1], tmp.rZ = ref5[2], tmp.sX = ref5[3], tmp.sY = ref5[4], tmp.sZ = ref5[5], tmp.tX = ref5[6], tmp.tY = ref5[7], tmp.tZ = ref5[8];
          } else {
            throw RangeError(M + "Optional `set` is string but not 'reset' or log|nwang format");
          }
        }
      }
      if (ªU !== tDelta) {
        stale = true;
        if (ªO === tDelta) {
          ref6 = ['rX', 'rY', 'rZ', 'sX', 'sY', 'sZ', 'tX', 'tY', 'tZ'];
          for (o = 0, len2 = ref6.length; o < len2; o++) {
            key = ref6[o];
            val = delta[key];
            tVal = typeof val;
            if (ªU !== tVal) {
              if (ªN !== tVal) {
                throw TypeError(M + "`delta." + key + "` is " + (ªtype(val)) + " not number");
              }
              if (isNaN(val)) {
                throw TypeError(M + "`delta." + key + "` is NaN");
              }
              if ('s' === key.charAt(0)) {
                tmp[key] *= val;
              } else {
                tmp[key] += val;
              }
            }
          }
        } else if (ªS === tDelta && 0xAFE8 < delta.charCodeAt(0)) {
          sf3 = this.main.nwang.sf3;
          if (9 === delta.length) {
            ref7 = ['rX', 'rY', 'rZ', 'sX', 'sY', 'sZ', 'tX', 'tY', 'tZ'];
            for (i = q = 0, len3 = ref7.length; q < len3; i = ++q) {
              key = ref7[i];
              val = +sf3(delta.charAt(i));
              if ('s' === key.charAt(0)) {
                tmp[key] *= val;
              } else {
                tmp[key] += val;
              }
            }
          } else {
            throw RangeError(M + "`delta` appears to be 'nwang' but is " + delta.length + " characters");
          }
        } else if (ªS === tDelta) {
          vals = delta.split(' ');
          if ('rst' === vals[0] + vals[4] + vals[8]) {
            keys = ['-', 'rX', 'rY', 'rZ', '-', 'sX', 'sY', 'sZ', '-', 'tX', 'tY', 'tZ'];
            ref8 = [1, 2, 3, 5, 6, 7, 9, 10, 11];
            for (u = 0, len4 = ref8.length; u < len4; u++) {
              i = ref8[u];
              key = keys[i];
              val = +vals[i];
              if (!isNaN(val)) {
                throw RangeError(M + "`delta` appears to be 9-char 'log' with non-numeric values");
              }
              if (5 <= i && 7 >= i) {
                tmp[key] *= val;
              } else {
                tmp[key] += val;
              }
            }
          } else {
            throw RangeError(M + "Optional `delta` is a string, but not 'log|nwang' format");
          }
        } else if (ªX !== tDelta) {
          throw TypeError(M + "Optional `delta` is " + tDelta + " not string|object");
        }
      }
      for (key in tmp) {
        val = tmp[key];
        this[key] = val;
      }
      if (stale) {
        rXc = Math.cos(this.rX);
        rXs = Math.sin(this.rX);
        rYs = Math.sin(this.rY);
        rYc = Math.cos(this.rY);
        rZs = Math.sin(this.rZ);
        rZc = Math.cos(this.rZ);
        if ('trs' === this.oT) {
          this.mT = new Float32Array([rYc * rZc * this.sX, (rXc * rZs + rXs * rYs * rZc) * this.sX, (rXs * rZs - rXc * rYs * rZc) * this.sX, 0, -rYc * rZs * this.sY, (rXc * rZc - rXs * rYs * rZs) * this.sY, (rXs * rZc + rXc * rYs * rZs) * this.sY, 0, rYs * this.sZ, -rXs * rYc * this.sZ, rXc * rYc * this.sZ, 0, this.tX, this.tY, this.tZ, 1]);
        } else if ('srt' === this.oT) {
          this.mT = new Float32Array([rYc * rZc * this.sX, (rXc * rZs + rXs * rYs * rZc) * this.sY, (rXs * rZs - rXc * rYs * rZc) * this.sZ, 0, -rYc * rZs * this.sX, (rXc * rZc - rXs * rYs * rZs) * this.sY, (rXs * rZc + rXc * rYs * rZs) * this.sZ, 0, rYs * this.sX, -rXs * rYc * this.sY, rXc * rYc * this.sZ, 0, 99, 99, 99, 1]);
          this.mT[12] = this.mT[0] * this.tX + this.mT[4] * this.tY + this.mT[8] * this.tZ;
          this.mT[13] = this.mT[1] * this.tX + this.mT[5] * this.tY + this.mT[9] * this.tZ;
          this.mT[14] = this.mT[2] * this.tX + this.mT[6] * this.tY + this.mT[10] * this.tZ;
        } else if ('rts' === this.oT) {
          a = new Float32Array([1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1]);
          a10 = a[4];
          a11 = a[5];
          a12 = a[6];
          a13 = a[7];
          a20 = a[8];
          a21 = a[9];
          a22 = a[10];
          a23 = a[11];
          a[4] = a10 * rXc + a20 * rXs;
          a[5] = a11 * rXc + a21 * rXs;
          a[6] = a12 * rXc + a22 * rXs;
          a[7] = a13 * rXc + a23 * rXs;
          a[8] = a20 * rXc - a10 * rXs;
          a[9] = a21 * rXc - a11 * rXs;
          a[10] = a22 * rXc - a12 * rXs;
          a[11] = a23 * rXc - a13 * rXs;
          a00 = a[0];
          a01 = a[1];
          a02 = a[2];
          a03 = a[3];
          a20 = a[8];
          a21 = a[9];
          a22 = a[10];
          a23 = a[11];
          a[0] = a00 * rYc - a20 * rYs;
          a[1] = a01 * rYc - a21 * rYs;
          a[2] = a02 * rYc - a22 * rYs;
          a[3] = a03 * rYc - a23 * rYs;
          a[8] = a00 * rYs + a20 * rYc;
          a[9] = a01 * rYs + a21 * rYc;
          a[10] = a02 * rYs + a22 * rYc;
          a[11] = a03 * rYs + a23 * rYc;
          a00 = a[0];
          a01 = a[1];
          a02 = a[2];
          a03 = a[3];
          a10 = a[4];
          a11 = a[5];
          a12 = a[6];
          a13 = a[7];
          a[0] = a00 * rZc + a10 * rZs;
          a[1] = a01 * rZc + a11 * rZs;
          a[2] = a02 * rZc + a12 * rZs;
          a[3] = a03 * rZc + a13 * rZs;
          a[4] = a10 * rZc - a00 * rZs;
          a[5] = a11 * rZc - a01 * rZs;
          a[6] = a12 * rZc - a02 * rZs;
          a[7] = a13 * rZc - a03 * rZs;
          a[12] = a[0] * this.tX + a[4] * this.tY + a[8] * this.tZ + a[12];
          a[13] = a[1] * this.tX + a[5] * this.tY + a[9] * this.tZ + a[13];
          a[14] = a[2] * this.tX + a[6] * this.tY + a[10] * this.tZ + a[14];
          a[15] = a[3] * this.tX + a[7] * this.tY + a[11] * this.tZ + a[15];
          a[0] *= this.sX;
          a[1] *= this.sX;
          a[2] *= this.sX;
          a[3] *= this.sX;
          a[4] *= this.sY;
          a[5] *= this.sY;
          a[6] *= this.sY;
          a[7] *= this.sY;
          a[8] *= this.sZ;
          a[9] *= this.sZ;
          a[10] *= this.sZ;
          a[11] *= this.sZ;
          this.mT = a;
        }
      }
      return this;
    };

    Item.prototype["delete"] = function() {
      var M;
      M = "/oo3d/src/item/base-item.litcoffee Item#" + this.index + ":delete()\n  ";
      return this;
    };

    Item.prototype.reset = function(subject) {
      var M;
      M = "/oo3d/src/item/base-item.litcoffee Item#" + this.index + ":reset()\n  ";
      subject.mT = new Float32Array([1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1]);
      subject.rX = 0;
      subject.rY = 0;
      subject.rZ = 0;
      subject.sX = 1;
      subject.sY = 1;
      subject.sZ = 1;
      subject.tX = 0;
      subject.tY = 0;
      subject.tZ = 0;
      return subject;
    };

    xx = function() {};

    return Item;

  })();

  Item.Camera = (function(superClass) {
    extend(Camera, superClass);

    Camera.prototype.C = 'Item.Camera';

    Camera.prototype.toString = function() {
      return '[object Item.Camera]';
    };

    function Camera(main, index, config) {
      var M;
      if (config == null) {
        config = {};
      }
      M = "/oo3d/src/item/class-item-camera.litcoffee Item.Camera#" + (+index) + "()\n  ";
      Camera.__super__.constructor.call(this, main, index, config);
      this.fovy = config.fovy;
      if (ªU === ªtype(this.fovy)) {
        this.fovy = 0.785398163;
      } else if (ªN !== ªtype(this.fovy)) {
        throw TypeError(M + "Optional `config.fovy` is " + (ªtype(this.fovy)) + " not number");
      } else if (0 >= this.fovy) {
        throw RangeError(M + "Optional `config.fovy` is " + this.fovy + " not greater than zero");
      }
      this.aspect = config.aspect;
      if (ªU === ªtype(this.aspect)) {
        this.aspect = this.main.$main.width / this.main.$main.height;
      } else if (ªN !== ªtype(this.aspect)) {
        throw TypeError(M + "Optional `config.aspect` is " + (ªtype(this.aspect)) + " not number");
      } else if (0 >= this.aspect) {
        throw RangeError(M + "Optional `config.aspect` is " + this.aspect + " not greater than zero");
      }
      this.matProjection = mat4.perspective(this.fovy, this.aspect, 1, 100);
      this.matCamera = null;
      this.mT[14] = -4;
      this.tZ = -4;
      this.updateCamera();
    }

    Camera.prototype.updateCamera = function() {
      return this.matCamera = new Float32Array(mat4.multiply(this.matProjection, this.mT));
    };

    Camera.prototype.reset = function(subject) {
      var M;
      M = "/oo3d/src/item/class-item-camera.litcoffee Item.Camera#" + this.index + ":reset()\n  ";
      Camera.__super__.reset.call(this, subject);
      subject.mT[14] = -4;
      subject.tZ = -4;
      return subject;
    };

    return Camera;

  })(Item);

  Item.Mesh = (function(superClass) {
    extend(Mesh, superClass);

    Mesh.prototype.C = 'Item.Mesh';

    Mesh.prototype.toString = function() {
      return "[object Item.Mesh]";
    };

    function Mesh(main, index, config) {
      var M, type, val;
      if (config == null) {
        config = {};
      }
      M = "/oo3d/src/item/class-item-mesh.litcoffee Item.Mesh#" + (+index) + "()\n  ";
      Mesh.__super__.constructor.call(this, main, index, config);
      if (ªU === (type = ªtype((val = config.positionI)))) {
        this.bP = this.main._all[0];
      } else {
        this.bP = this.main._all[val];
        if (!this.bP) {
          if (ªN !== type) {
            throw TypeError(M + "Optional `config.positionI` is " + type + " not number");
          }
          if (ªMAX < val || val % 1 || 0 > val) {
            throw RangeError(M + "`config.positionI` is " + val + " not 0 or a +ve int < 2^53");
          }
          throw RangeError(M + "`config.positionI` no such instance `main._all[" + val + "]`");
        }
        if ('Buffer.Position' !== this.bP.C) {
          throw TypeError(M + "`config.positionI` refs " + this.bP.C + " at `main._all[" + val + "]`");
        }
      }
      if (ªU === (type = ªtype((val = config.colorI)))) {
        this.bC = this.main._all[1];
      } else {
        this.bC = this.main._all[val];
        if (!this.bC) {
          if (ªN !== type) {
            throw TypeError(M + "Optional `config.colorI` is " + type + " not number");
          }
          if (ªMAX < val || val % 1 || 0 > val) {
            throw RangeError(M + "`config.colorI` is " + val + " not 0 or a +ve int < 2^53");
          }
          throw RangeError(M + "`config.colorI` no such instance `main._all[" + val + "]`");
        }
        if ('Buffer.Color' !== this.bC.C) {
          throw TypeError(M + "`config.colorI` refs " + this.bC.C + " at `main._all[" + val + "]`");
        }
      }
      this.renderMode = config.renderMode || 'TRIANGLES';
      if (!Item.Mesh.validRenderMode[this.renderMode]) {
        throw Error(M + "`config.renderMode` " + this.renderMode + " is not recognised by WebGL");
      }
      if (!config.blend) {
        this.sBlend = null;
        this.dBlend = null;
      } else if (ªA !== ªtype(config.blend)) {
        throw Error(M + "If set, `config.blend` must be array not " + (ªtype(config.blend)));
      } else {
        if (!Item.Mesh.validBlend[config.blend[0]]) {
          throw Error(M + "`config.blend[0]` is not recognised by WebGL");
        }
        if (!Item.Mesh.validBlend[config.blend[1]]) {
          throw Error(M + "`config.blend[1]` is not recognised by WebGL");
        }
        this.sBlend = this.main.gl[config.blend[0]];
        this.dBlend = this.main.gl[config.blend[1]];
      }
      if (this.bP.count !== this.bC.count) {
        throw Error(M + "`config.positionI` mismatches config.colorI");
      }
      this.count = this.bP.count;
      this.color = pick.indexToColor(this.index);
    }

    Mesh.prototype.read = function(format) {
      var M, out, sf3;
      M = "/oo3d/src/item/class-item-mesh.litcoffee Item.Mesh#" + this.index + ":read()\n  ";
      out = Mesh.__super__.read.call(this, format);
      if (ªU === typeof format || 'object' === format) {
        out.bP = this.bP.index;
        out.bC = this.bC.index;
      } else if ('log' === format) {
        out += " bP " + this.bP.index + " bC " + this.bC.index;
      } else if ('nwang' === format) {
        sf3 = this.main.nwang.sf3;
        out += sf3(this.bP.index) + sf3(this.bC.index);
      }
      return out;
    };

    Mesh.prototype.edit = function(set, delta) {
      var M, bcval, bpval, sf3, tSet, tmp, type, val, vals;
      M = "/oo3d/src/item/class-item-mesh.litcoffee Item.Mesh#" + this.index + ":edit()\n  ";
      tSet = ªtype(set);
      tmp = {};
      if (ªO === tSet) {
        if (ªU !== (type = ªtype((val = set.bpi)))) {
          tmp.bp = this.main._all[val];
          if (!tmp.bp) {
            if (ªN !== type) {
              throw TypeError(M + "Optional `set.bpi` is " + type + " not number");
            }
            if (ªMAX < val || val % 1 || 0 > val) {
              throw RangeError(M + "Optional `set.bpi` is " + val + " not 0 or a +ve int < 2^53");
            }
            throw RangeError(M + "Optional `set.bpi` no such instance `main._all[" + val + "]`");
          }
          if ('Buffer.Position' !== tmp.bp.C) {
            throw TypeError(M + "Optional `set.bpi` refs " + tmp.bp.C + " at `main._all[" + val + "]`");
          }
        }
        if (ªU !== (type = ªtype((val = set.bci)))) {
          tmp.bc = this.main._all[val];
          if (!tmp.bc) {
            if (ªN !== type) {
              throw TypeError(M + "Optional `set.bci` is " + type + " not number");
            }
            if (ªMAX < val || val % 1 || 0 > val) {
              throw RangeError(M + "Optional `set.bci` is " + val + " not 0 or a +ve int < 2^53");
            }
            throw RangeError(M + "Optional `set.bci` no such instance `main._all[" + val + "]`");
          }
          if ('Buffer.Color' !== tmp.bc.C) {
            throw TypeError(M + "Optional `set.bci` refs " + tmp.bc.C + " at `main._all[" + val + "]`");
          }
        }
      } else if (ªS === tSet) {
        if (0xAFE8 < set.charCodeAt(0)) {
          sf3 = this.main.nwang.sf3;
          if (11 === set.length) {
            bpval = +(sf3(set.charAt(9)));
            bcval = +(sf3(set.charAt(10)));
            tmp.bp = this.main._all[bpval];
            tmp.bc = this.main._all[bcval];
            set = set.slice(0, 9);
          }
          if (bpval) {
            if (!tmp.bp) {
              if (bpval % 1 || 0 > bpval) {
                throw RangeError(M + "Nwang `bpi` value is " + bpval + " not 0 or a +ve int");
              }
              throw RangeError(M + "Nwang `bpi` no such instance `main._all[" + bpval + "]`");
            }
            if ('Buffer.Position' !== tmp.bp.C) {
              throw TypeError(M + "Nwang `bpi` refs " + tmp.bp.C + " at `main._all[" + bpval + "]`");
            }
          }
          if (bcval) {
            if (!tmp.bc) {
              if (bcval % 1 || 0 > bcval) {
                throw RangeError(M + "Nwang `bci` value is " + bcval + " not 0 or a +ve int");
              }
              throw RangeError(M + "Nwang `bci` no such instance `main._all[" + bcval + "]`");
            }
            if ('Buffer.Color' !== tmp.bc.C) {
              throw TypeError(M + "Nwang `bci` refs " + tmp.bc.C + " at `main._all[" + bcval + "]`");
            }
          }
        } else {
          vals = set.split(' ');
        }
      }
      if (tmp.bp && tmp.bc) {
        if (tmp.bp.count !== tmp.bc.count) {
          throw Error(M + "`set.bpi` mismatches `set.bci`");
        }
      } else if (tmp.bp && (tmp.bp.count !== this.bC.count)) {
        throw Error(M + "`set.bpi` mismatches the mesh’s Buffer.Color#" + this.bC.index);
      } else if (tmp.bc && (tmp.bc.count !== this.bP.count)) {
        throw Error(M + "`set.bci` mismatches the mesh’s Buffer.Position#" + this.bP.index);
      }
      Mesh.__super__.edit.call(this, set, delta);
      if (tmp.bp) {
        this.bP = tmp.bp;
      }
      if (tmp.bc) {
        this.bC = tmp.bc;
      }
      this.count = this.bP.count;
      if ('reset' === set) {
        this.bP = 0;
        this.bC = 1;
      }
      return this;
    };

    Mesh.prototype["delete"] = function(targetI) {
      var M;
      M = "/oo3d/src/item/class-item-mesh.litcoffee Item.Mesh#" + this.index + ":delete()\n  ";
      return this;
    };

    return Mesh;

  })(Item);

  Item.Mesh.validRenderMode = {
    'POINTS': 1,
    'LINES': 1,
    'LINE_STRIP': 1,
    'LINE_LOOP': 1,
    'TRIANGLES': 1,
    'TRIANGLE_STRIP': 1,
    'TRIANGLE_FAN': 1
  };

  Item.Mesh.validBlend = {
    'ZERO': 1,
    'ONE': 1,
    'SRC_COLOR': 1,
    'ONE_MINUS_SRC_COLOR': 1,
    'DST_COLOR': 1,
    'ONE_MINUS_DST_COLOR': 1,
    'SRC_ALPHA': 1,
    'ONE_MINUS_SRC_ALPHA': 1,
    'DST_ALPHA': 1,
    'ONE_MINUS_DST_ALPHA': 1,
    'SRC_ALPHA_SATURATE': 1
  };

  Layer = (function() {
    Layer.prototype.C = 'Layer';

    Layer.prototype.toString = function() {
      return '[object Layer]';
    };

    function Layer(main1, index1, config) {
      var M, i, index, j, len, num, rd, ref, tRIs, tSc;
      this.main = main1;
      this.index = index1;
      if (config == null) {
        config = {};
      }
      M = "/oo3d/src/layer/base-layer.litcoffee Layer#" + (+this.index) + "()\n  ";
      if (ªO !== ªtype(config)) {
        throw TypeError(M + "Optional `config` is " + (ªtype(config)) + " not object");
      }
      if (ªO !== typeof this.main) {
        throw TypeError(M + "`main` is " + (ªtype(this.main)) + " not object");
      }
      if ('[object Oo3d]' !== '' + this.main) {
        throw TypeError(M + "`main` is '" + this.main + "' not '[object Oo3d]'");
      }
      if (ªN !== typeof this.index) {
        throw TypeError(M + "`index` is " + (ªtype(this.index)) + " not number");
      }
      if (ªMAX < this.index || this.index % 1 || 0 > this.index) {
        throw RangeError(M + "`index` is " + this.index + " not 0 or a positive integer below 2^53");
      }
      tRIs = ªtype(config.rendererIs);
      if (ªU === tRIs) {
        this.renderers = [];
      } else if (ªA !== tRIs) {
        throw TypeError(M + "`config.rendererIs` is " + tRIs + " not array");
      } else {
        this.renderers = (function() {
          var j, len, ref, results;
          ref = config.rendererIs;
          results = [];
          for (i = j = 0, len = ref.length; j < len; i = ++j) {
            index = ref[i];
            if (ªN !== typeof index) {
              throw TypeError(M + "`config.rendererIs[" + i + "]` is " + (ªtype(index)) + " not number");
            }
            rd = this.main._all[index];
            if (!rd || !(rd instanceof Renderer)) {
              throw TypeError(M + "`config.rendererIs[" + i + "]` refs " + rd.C + " at `main._all[" + index + "]`");
            }
            results.push(rd);
          }
          return results;
        }).call(this);
      }
      tSc = ªtype(config.scissor);
      if (ªU === tSc || ªX === tSc) {
        this.scissor = null;
      } else if (ªA !== tSc) {
        throw TypeError(M + "`config.scissor` is " + tSc + " not array|null");
      } else if (4 !== config.scissor.length) {
        throw RangeError(M + "`config.scissor.length` must be 4 not " + config.scissor.length);
      } else {
        ref = config.scissor;
        for (i = j = 0, len = ref.length; j < len; i = ++j) {
          num = ref[i];
          if (ªN !== typeof num) {
            throw TypeError(M + "`config.scissor[" + i + "]` is " + (ªtype(num)) + " not number");
          }
          if (0 > num || 1 < num) {
            throw RangeError(M + "`config.scissor[" + i + "]` is out-of-range " + num);
          }
        }
      }
      this.scissor = config.scissor;
    }

    Layer.prototype.render = function() {
      var j, len, ref, renderer, results;
      if (this.scissor) {
        this.main.gl.scissor(this.scissor[0] * this.main.$main.width, this.scissor[1] * this.main.$main.height, this.scissor[2] * this.main.$main.width, this.scissor[3] * this.main.$main.height);
      }
      ref = this.renderers;
      results = [];
      for (j = 0, len = ref.length; j < len; j++) {
        renderer = ref[j];
        results.push(renderer.render());
      }
      return results;
    };

    return Layer;

  })();

  Layer.Simple = (function(superClass) {
    extend(Simple, superClass);

    Simple.prototype.C = 'Layer.Simple';

    Simple.prototype.toString = function() {
      return '[object Layer.Simple]';
    };

    function Simple(main, index, config) {
      var M;
      if (config == null) {
        config = {};
      }
      M = "/oo3d/src/layer/class-layer-simple.litcoffee Layer.Simple#" + (+index) + "()\n  ";
      Simple.__super__.constructor.call(this, main, index, config);
    }

    return Simple;

  })(Layer);

  Program = (function() {
    Program.prototype.C = 'Program';

    Program.prototype.toString = function() {
      return "[object Program]";
    };

    function Program(main1, index1, config) {
      var M, gl;
      this.main = main1;
      this.index = index1;
      if (config == null) {
        config = {};
      }
      M = "/oo3d/src/layer/base-layer.litcoffee Program#" + (+this.index) + "()\n  ";
      if (ªO !== ªtype(config)) {
        throw TypeError(M + "Optional `config` is " + (ªtype(config)) + " not object");
      }
      if (ªO !== typeof this.main) {
        throw TypeError(M + "`main` is " + (ªtype(this.main)) + " not object");
      }
      if ('[object Oo3d]' !== '' + this.main) {
        throw TypeError(M + "`main` is '" + this.main + "' not '[object Oo3d]'");
      }
      if (ªN !== typeof this.index) {
        throw TypeError(M + "`index` is " + (ªtype(this.index)) + " not number");
      }
      if (ªMAX < this.index || this.index % 1 || 0 > this.index) {
        throw RangeError(M + "`index` is " + this.index + " not 0 or a positive integer below 2^53");
      }
      gl = this.main.gl;
      this.vertexShader = gl.createShader(gl.VERTEX_SHADER);
      gl.shaderSource(this.vertexShader, this.vertexSource());
      gl.compileShader(this.vertexShader);
      if (!gl.getShaderParameter(this.vertexShader, gl.COMPILE_STATUS)) {
        this["delete"]();
        throw Error(this.C + ".vertexShader failed to compile");
      }
      this.fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);
      gl.shaderSource(this.fragmentShader, this.fragmentSource());
      gl.compileShader(this.fragmentShader);
      if (!gl.getShaderParameter(this.fragmentShader, gl.COMPILE_STATUS)) {
        this["delete"]();
        throw Error(this.C + ".fragmentShader failed to compile");
      }
      this.program = gl.createProgram();
      gl.attachShader(this.program, this.vertexShader);
      gl.attachShader(this.program, this.fragmentShader);
      gl.linkProgram(this.program);
      if (!gl.getProgramParameter(this.program, gl.LINK_STATUS)) {
        this["delete"]();
        throw Error(this.C + ".program failed to link");
      }
    }

    Program.prototype["delete"] = function() {
      var M;
      M = "/oo3d/src/program/base-program.litcoffee Program:delete()\n  ";
      if (this.vertexShader) {
        this.main.gl.deleteShader(this.vertexShader);
      }
      if (this.fragmentShader) {
        this.main.gl.deleteShader(this.fragmentShader);
      }
      if (this.program) {
        this.main.gl.deleteProgram(this.program);
      }
      return this;
    };

    Program.prototype.vertexSource = function() {
      return "void main() {\n}";
    };

    Program.prototype.fragmentSource = function() {
      return "void main() {\n}";
    };

    return Program;

  })();

  Program.Flat = (function(superClass) {
    extend(Flat, superClass);

    Flat.prototype.C = 'Program.Flat';

    Flat.prototype.toString = function() {
      return "[object Program.Flat]";
    };

    function Flat(main, index, config) {
      var M, gl;
      if (config == null) {
        config = {};
      }
      M = "/oo3d/src/program/class-program-flat.litcoffee Program.Flat#" + (+index) + "()\n  ";
      Flat.__super__.constructor.call(this, main, index, config);
      gl = this.main.gl;
      gl.useProgram(this.program);
      this.aVtxPositionLoc = gl.getAttribLocation(this.program, 'aVtxPosition');
      gl.enableVertexAttribArray(this.aVtxPositionLoc);
      this.aVtxColorLoc = gl.getAttribLocation(this.program, 'aVtxColor');
      this.uMatTransformLoc = gl.getUniformLocation(this.program, 'uMatTransform');
      this.uMatCameraLoc = gl.getUniformLocation(this.program, 'uMatCamera');
    }

    Flat.prototype.vertexSource = function() {
      return "attribute vec3 aVtxPosition;\nattribute vec4 aVtxColor;\n\nuniform mat4 uMatTransform;\nuniform mat4 uMatCamera;\n\nvarying vec4 vColor; // declare `vColor`\n\nvoid main() {\n\n  //// Increase the size of gl.POINT from 1px to 4px. \n  gl_PointSize = 4.0;\n\n  //// Apply the Camera and Mesh transforms to each vertex position. \n  //// Note that the order of these three is important. \n  gl_Position = uMatCamera * uMatTransform * vec4(aVtxPosition, 1);\n\n  //// Pass the vertex-color attribute unchanged to the fragment-shader. \n  vColor = aVtxColor;\n}";
    };

    Flat.prototype.fragmentSource = function() {
      return "precision mediump float; // boilerplate for mobile-friendly shaders\n\nvarying vec4 vColor; // linear-interpolated input from fragment-shader\n\nvoid main(void) {\n  gl_FragColor = vColor;\n}";
    };

    return Flat;

  })(Program);

  Program.FlatItem = (function(superClass) {
    extend(FlatItem, superClass);

    FlatItem.prototype.C = 'Program.FlatItem';

    FlatItem.prototype.toString = function() {
      return "[object FlatItem]";
    };

    function FlatItem(main, index, config) {
      var M, gl;
      if (config == null) {
        config = {};
      }
      M = "/oo3d/src/program/class-program-flatitem.litcoffee Program.FlatItem#" + (+index) + "()\n  ";
      FlatItem.__super__.constructor.call(this, main, index, config);
      gl = this.main.gl;
      gl.useProgram(this.program);
      this.aVtxPositionLoc = gl.getAttribLocation(this.program, 'aVtxPosition');
      gl.enableVertexAttribArray(this.aVtxPositionLoc);
      this.uMatTransformLoc = gl.getUniformLocation(this.program, 'uMatTransform');
      this.uMatCameraLoc = gl.getUniformLocation(this.program, 'uMatCamera');
      this.uMeshColorLoc = gl.getUniformLocation(this.program, 'uMeshColor');
    }

    FlatItem.prototype.vertexSource = function() {
      return "attribute vec3 aVtxPosition;\n\nuniform mat4 uMatTransform;\nuniform mat4 uMatCamera;\n\nuniform vec4 uMeshColor; // the mesh renders as a single flat color\n\n\nvarying vec4 vColor; // declare `vColor`\n\nvoid main() {\n\n  //// Multiply the position by the camera transformation and matrices. \n  //// Note that the order of these three is important. \n  gl_Position = uMatCamera * uMatTransform * vec4(aVtxPosition, 1);\n\n  //// Pass the vertex-color attribute unchanged to the fragment-shader. \n  vColor = uMeshColor;\n\n}";
    };

    FlatItem.prototype.fragmentSource = function() {
      return "precision mediump float; // boilerplate for mobile-friendly shaders\n\nvarying vec4 vColor; // linear-interpolated input from fragment-shader\n\nvoid main() {\n  gl_FragColor = vColor;\n}";
    };

    return FlatItem;

  })(Program);

  Program.Flatwhite = (function(superClass) {
    extend(Flatwhite, superClass);

    Flatwhite.prototype.C = 'Program.Flatwhite';

    Flatwhite.prototype.toString = function() {
      return "[object Flatwhite]";
    };

    function Flatwhite(main, index, config) {
      var M, gl;
      if (config == null) {
        config = {};
      }
      M = "/oo3d/src/program/class-program-flatwhite.litcoffee Program.Flatwhite#" + (+index) + "()\n  ";
      Flatwhite.__super__.constructor.call(this, main, index, config);
      gl = this.main.gl;
      gl.useProgram(this.program);
      this.aVtxPositionLoc = gl.getAttribLocation(this.program, 'aVtxPosition');
      gl.enableVertexAttribArray(this.aVtxPositionLoc);
      this.uMatTransformLoc = gl.getUniformLocation(this.program, 'uMatTransform');
      this.uMatCameraLoc = gl.getUniformLocation(this.program, 'uMatCamera');
    }

    Flatwhite.prototype.vertexSource = function() {
      return "attribute vec3 aVtxPosition;\n\nuniform mat4 uMatTransform;\nuniform mat4 uMatCamera;\n\nvoid main() {\n\n  //// Multiply the position by the camera transformation and matrices. \n  //// Note that the order of these three is important. \n  gl_Position = uMatCamera * uMatTransform * vec4(aVtxPosition, 1);\n\n}";
    };

    Flatwhite.prototype.fragmentSource = function() {
      return "precision mediump float; // boilerplate for mobile-friendly shaders\n\nvec4 white = vec4(1.0,1.0,1.0,1.0);\n\nvoid main() {\n  gl_FragColor = white;\n}";
    };

    return Flatwhite;

  })(Program);

  Renderer = (function() {
    var RendererTypeError;

    Renderer.prototype.C = 'Renderer';

    Renderer.prototype.toString = function() {
      return "[object Renderer]";
    };

    function Renderer(main1, index1, config) {
      var M, i, index, mesh, tMIs;
      this.main = main1;
      this.index = index1;
      if (config == null) {
        config = {};
      }
      M = "/oo3d/src/renderer/base-renderer.litcoffee Renderer#" + (+this.index) + "()\n  ";
      if (ªO !== ªtype(config)) {
        throw TypeError(M + "Optional `config` is " + (ªtype(config)) + " not object");
      }
      if (ªO !== typeof this.main) {
        throw TypeError(M + "`main` is " + (ªtype(this.main)) + " not object");
      }
      if ('[object Oo3d]' !== '' + this.main) {
        throw TypeError(M + "`main` is '" + this.main + "' not '[object Oo3d]'");
      }
      if (ªN !== typeof this.index) {
        throw TypeError(M + "`index` is " + (ªtype(this.index)) + " not number");
      }
      if (ªMAX < this.index || this.index % 1 || 0 > this.index) {
        throw RangeError(M + "`index` is " + this.index + " not 0 or a positive integer below 2^53");
      }
      if (ªN !== typeof config.programI) {
        throw TypeError(M + "config.programI is " + (ªtype(config.programI)) + " not number");
      }
      this.program = this.main._all[config.programI] || (function() {
        throw RangeError(M + "No such index " + config.programI + " in main._all");
      })();
      if (ªN !== typeof config.cameraI) {
        throw TypeError(M + "config.cameraI is " + (ªtype(config.cameraI)) + " not number");
      }
      this.camera = this.main._all[config.cameraI] || (function() {
        throw RangeError(M + "No such index " + config.cameraI + " in main._all");
      })();
      this.uMatCameraLoc = this.main.gl.getUniformLocation(this.program.program, 'uMatCamera');
      tMIs = ªtype(config.meshIs);
      if (ªU === tMIs) {
        this.meshes = [];
      } else if (ªA !== tMIs) {
        throw TypeError(M + "`config.meshIs` is " + tMIs + " not array");
      } else {
        this.meshes = (function() {
          var j, len, ref, results;
          ref = config.meshIs;
          results = [];
          for (i = j = 0, len = ref.length; j < len; i = ++j) {
            index = ref[i];
            if (ªN !== typeof index) {
              throw TypeError(M + "`config.meshIs[" + i + "]` is " + (ªtype(index)) + " not number");
            }
            mesh = this.main._all[index];
            if (!mesh || !(mesh instanceof Item.Mesh)) {
              throw TypeError(M + "`config.meshIs[" + i + "]` refs " + mesh.C + " at `main._all[" + index + "]`");
            }
            results.push(mesh);
          }
          return results;
        }).call(this);
      }
    }

    Renderer.prototype["delete"] = function(targetI, classParts) {
      var M, i;
      M = "/oo3d/src/renderer/base-renderer.litcoffee Renderer#" + this.index + ":delete()\n  ";
      if ('Mesh' === classParts[1]) {
        i = this.meshes.length;
        while (0 <= --i) {
          if (targetI === this.meshes[i].index) {
            this.meshes.splice(i, 1);
            return this;
          }
        }
        return this;
      }
      if ('Camera' === classParts[1]) {
        if (this.camera.index === targetI) {
          throw RangeError(M + "Cannot delete Camera#" + targetI + "` - used by Renderer#" + this.index + "`");
        } else {
          return this;
        }
      }
      if ('Program' === classParts[0]) {
        if (this.program.index === targetI) {
          throw RangeError(M + "Cannot delete Program#" + targetI + "` - used by Renderer#" + this.index + "`");
        } else {
          return this;
        }
      }
      throw RangeError(M + "`main._all[" + targetI + "]` is '" + (classParts.join('.')) + "' not 'Program|Item.Camera|Item.Mesh");
    };

    Renderer.prototype.render = function() {
      var $main, aVtxColorLoc, aVtxPositionLoc, gl, index, main, mesh, mode, uMatTransformLoc, uMeshColorLoc;
      main = this.main;
      $main = main.$main;
      gl = main.gl;
      aVtxPositionLoc = this.program.aVtxPositionLoc;
      aVtxColorLoc = this.program.aVtxColorLoc || false;
      uMatTransformLoc = this.program.uMatTransformLoc;
      uMeshColorLoc = this.program.uMeshColorLoc;
      if (!gl) {
        throw Error("The WebGL rendering context is " + (ªtype(gl)));
      }
      gl.useProgram(this.program.program);
      gl.uniformMatrix4fv(this.uMatCameraLoc, false, this.camera.matCamera);
      if (aVtxColorLoc) {
        gl.enableVertexAttribArray(aVtxColorLoc);
      }
      index = this.meshes.length;
      while (index--) {
        mesh = this.meshes[index];
        if (!mesh) {
          continue;
        }
        gl.uniformMatrix4fv(uMatTransformLoc, gl.FALSE, mesh.mT);
        if (uMeshColorLoc) {
          gl.uniform4fv(uMeshColorLoc, mesh.color);
        }
        gl.bindBuffer(gl.ARRAY_BUFFER, mesh.bP.glData);
        gl.vertexAttribPointer(aVtxPositionLoc, 3, gl.FLOAT, false, 0, 0);
        if (aVtxColorLoc) {
          gl.bindBuffer(gl.ARRAY_BUFFER, mesh.bC.glData);
          gl.vertexAttribPointer(aVtxColorLoc, 4, gl.FLOAT, false, 0, 0);
        }
        if (null !== mesh.sBlend) {
          gl.enable(gl.BLEND);
          gl.blendFunc(mesh.sBlend, mesh.dBlend);
        } else {
          gl.disable(gl.BLEND);
        }
        mode = gl[mesh.renderMode];
        gl.drawArrays(mode, 0, mesh.count);
        gl.flush();
      }
      if (aVtxColorLoc) {
        return gl.disableVertexAttribArray(aVtxColorLoc);
      }
    };

    RendererTypeError = (function(superClass) {
      extend(RendererTypeError, superClass);

      function RendererTypeError(message) {
        this.message = "Renderer " + message;
        this.name = this.constructor.name;
      }

      RendererTypeError.prototype = new Error();

      RendererTypeError.prototype.constructor = RendererTypeError;

      return RendererTypeError;

    })(TypeError);

    return Renderer;

  })();

  Renderer.Wireframe;

  Renderer.Wireframe = (function(superClass) {
    extend(Wireframe, superClass);

    Wireframe.prototype.C = 'Renderer.Wireframe';

    Wireframe.prototype.toString = function() {
      return '[object Renderer.Wireframe]';
    };

    function Wireframe(main, index, config) {
      var M;
      if (config == null) {
        config = {};
      }
      M = "/oo3d/src/renderer/class-renderer-wireframe.litcoffee Renderer.Wireframe#" + (+index) + "()\n  ";
      Wireframe.__super__.constructor.call(this, main, index, config);
    }

    return Wireframe;

  })(Renderer);

}).call(this);
// Generated by CoffeeScript 1.9.2

/*! Magnubbin 0.0.19 //// MIT Licence //// http://magnubbin.loop.coop/ */

(function() {
  var Main, Ookonsole, afterInteraction, grid9IsActive, grid9OnlyShow, injectCSS, injectHTML, onMousedown, onMousemove, onMouseup, onPresetClick, onTouchend, onTouchmove, onTouchstart, parseQuery, rxyDelta, ryzDelta, scaleDelta, txyDelta, txzDelta, vpSize, ª, ªA, ªB, ªC, ªE, ªF, ªN, ªO, ªR, ªS, ªU, ªV, ªX, ªex, ªhas, ªredefine, ªtype, ªuid;

  ªC = 'Magnubbin';

  ªV = '0.0.19';

  ªA = 'array';

  ªB = 'boolean';

  ªE = 'error';

  ªF = 'function';

  ªN = 'number';

  ªO = 'object';

  ªR = 'regexp';

  ªS = 'string';

  ªU = 'undefined';

  ªX = this;

  ª = console.log.bind(console);

  ªex = function(x, a, b) {
    var pos;
    if (-1 === (pos = a.indexOf(x))) {
      return x;
    } else {
      return b.charAt(pos);
    }
  };

  ªhas = function(h, n, t, f) {
    if (t == null) {
      t = true;
    }
    if (f == null) {
      f = false;
    }
    if (-1 !== h.indexOf(n)) {
      return t;
    } else {
      return f;
    }
  };

  ªtype = function(x) {
    return {}.toString.call(x).match(/\s([a-z|A-Z]+)/)[1].toLowerCase();
  };

  ªuid = function(p) {
    return p + '_' + (Math.random() + '1111111111111111').slice(2, 18);
  };

  ªredefine = function(obj, name, value, kind) {
    switch (kind) {
      case 'constant':
        return Object.defineProperty(obj, name, {
          value: value,
          enumerable: true
        });
      case 'private':
        return Object.defineProperty(obj, name, {
          value: value,
          enumerable: false
        });
    }
  };

  Main = (function() {
    Main.prototype.C = ªC;

    Main.prototype.toString = function() {
      return "[object " + this.C + "]";
    };

    function Main(config) {
      var error, k, query, v;
      if (config == null) {
        config = {};
      }
      for (k in config) {
        v = config[k];
        this[k] = v;
      }
      this.ookonsole = null;
      this.oo3d = null;
      this.$$presets = null;
      this.focusI = void 0;
      this.downPos = null;
      this.deltaCalc = function(x, y) {
        return {};
      };
      this.snapshot = null;
      this.delta = null;
      if (this.$cssTarget) {
        injectCSS(this.$cssTarget, "Injected by " + ªC + " " + ªV);
      }
      if (this.$htmlTarget) {
        injectHTML(this.$htmlTarget, "Injected by " + ªC + " " + ªV);
      }
      try {
        this.ookonsole = new Ookonsole({
          $display: $('#ookonsole-display'),
          $command: $('#ookonsole-command'),
          context: this
        });
        this.initTasks();
        this.ookonsole.show();
        this.ookonsole.start();
      } catch (_error) {
        error = _error;
        $('#magnubbin-error').innerHTML = error;
        $('#magnubbin-error').className = '';
        return;
      }
      try {
        this.$main = $('#oo3d-main');
        this.oo3d = new Oo3d({
          $main: this.$main,
          bkgnd: new Float32Array([1, 1, 1, 1])
        });
        this.flatrPositionI = this.oo3d.add('Buffer.Position', {
          data: [0.000, -0.330, 1.732, -2.000, -0.330, -1.732, 2.000, -0.330, -1.732, 0.000, -0.330, 1.732, -2.000, -0.330, -1.732, 0.000, 0.660, 1.588, 0.000, -0.330, 1.732, 2.000, -0.330, -1.732, 0.000, 0.660, 1.588, -2.000, -0.330, -1.732, 2.000, -0.330, -1.732, 0.000, 0.660, 1.588]
        });
        this.betrPositionI = this.oo3d.add('Buffer.Position', {
          data: [0.000, -0.471, 2.135, -1.265, -0.471, -1.660, 1.581, -0.471, -2.609, 0.000, -0.471, 2.135, -1.265, -0.471, -1.660, -0.119, 0.942, 0.725, 0.000, -0.471, 2.135, 1.581, -0.471, -2.609, -0.119, 0.942, 0.725, -1.265, -0.471, -1.660, 1.581, -0.471, -2.609, -0.119, 0.942, 0.725]
        });
        this.ocrexPositionI = this.oo3d.add('Buffer.Position', {
          data: [0.000, -0.756, 2.291, -2.000, -0.756, -2.291, 2.000, -0.756, -2.291, 0.000, -0.756, 2.291, -2.000, -0.756, -2.291, 0.000, 1.512, 0.327, 0.000, -0.756, 2.291, 2.000, -0.756, -2.291, 0.000, 1.512, 0.327, -2.000, -0.756, -2.291, 2.000, -0.756, -2.291, 0.000, 1.512, 0.327]
        });
        this.icosPositionI = this.oo3d.add('Buffer.Position', {
          data: [0.000, -0.744, 2.291, -2.000, -0.744, -2.291, 2.000, -0.744, -2.291, 0.000, -0.744, 2.291, -2.000, -0.744, -2.291, 0.000, 1.489, -2.182, 0.000, -0.744, 2.291, 2.000, -0.744, -2.291, 0.000, 1.489, -2.182, -2.000, -0.744, -2.291, 2.000, -0.744, -2.291, 0.000, 1.489, -2.182]
        });
        this.decrPositionI = this.oo3d.add('Buffer.Position', {
          data: [0.000, -0.634, 3.083, -1.581, -0.634, -1.660, 2.530, -0.634, -4.506, 0.000, -0.634, 3.083, -1.581, -0.634, -1.660, 0.731, 1.269, -1.482, 0.000, -0.634, 3.083, 2.530, -0.634, -4.506, 0.731, 1.269, -1.482, -1.581, -0.634, -1.660, 2.530, -0.634, -4.506, 0.731, 1.269, -1.482]
        });
        this.sqishPositionI = this.oo3d.add('Buffer.Position', {
          data: [0.000, -0.485, 3.303, -1.984, -0.485, -2.359, 2.646, -0.485, -4.247, 0.000, -0.485, 3.303, -1.984, -0.485, -2.359, -0.220, 0.970, -0.417, 0.000, -0.485, 3.303, 2.646, -0.485, -4.247, -0.220, 0.970, -0.417, -1.984, -0.485, -2.359, 2.646, -0.485, -4.247, -0.220, 0.970, -0.417]
        });
        this.slysPositionI = this.oo3d.add('Buffer.Position', {
          data: [0.000, -0.678, 3.992, -0.500, -0.678, -3.992, 0.500, -0.678, -3.992, 0.000, -0.678, 3.992, -0.500, -0.678, -3.992, 0.000, 1.356, 0.548, 0.000, -0.678, 3.992, 0.500, -0.678, -3.992, 0.000, 1.356, 0.548, -0.500, -0.678, -3.992, 0.500, -0.678, -3.992, 0.000, 1.356, 0.548]
        });
        this.spykPositionI = this.oo3d.add('Buffer.Position', {
          data: [0.000, -0.288, 3.992, -0.500, -0.288, -3.992, 0.500, -0.288, -3.992, 0.000, -0.288, 3.992, -0.500, -0.288, -3.992, 0.000, 0.577, -3.961, 0.000, -0.288, 3.992, 0.500, -0.288, -3.992, 0.000, 0.577, -3.961, -0.500, -0.288, -3.992, 0.500, -0.288, -3.992, 0.000, 0.577, -3.961]
        });
        this.genericColorI = this.oo3d.add('Buffer.Color', {
          data: [0.3, 0.0, 0.0, 0.95, 0.3, 0.0, 0.0, 0.95, 0.3, 0.0, 0.0, 0.95, 0.0, 0.25, 0.0, 0.75, 0.0, 0.25, 0.0, 0.75, 0.0, 0.25, 0.0, 0.75, 1.0, 0.25, 0.0, 0.10, 1.0, 0.25, 0.0, 0.10, 1.0, 0.25, 0.0, 0.10, 0.25, 0.5, 1.0, 0.05, 0.25, 0.5, 1.0, 0.05, 0.25, 0.5, 1.0, 0.05]
        });
        this.cameraI = this.oo3d.add('Item.Camera', {
          fovy: 0.785398163,
          aspect: this.$main.width / this.$main.height
        });
        this.flatItemProgramI = this.oo3d.add('Program.FlatItem', {
          subclass: 'Flat'
        });
        this.rendererI = this.oo3d.add('Renderer.Wireframe', {
          cameraI: this.cameraI,
          programI: this.flatItemProgramI,
          meshIs: []
        });
        this.layerI = this.oo3d.add('Layer.Simple', {
          rendererIs: [this.rendererI],
          scissor: [0, 0, 1, 1]
        });
        this.oo3d.render();
      } catch (_error) {
        error = _error;
        $('#magnubbin-error').innerHTML = error;
        $('#magnubbin-error').className = '';
        return;
      }
      query = parseQuery(window.location.search.slice(1));
      if (query.scene_v1) {
        this.ookonsole.execute('restore ' + query.scene_v1);
      } else {
        $('.magnubbin-preexisting').className = 'magnubbin-preexisting active';
        $('.magnubbin-icon-info').className = 'magnubbin-icon-info active';
      }
      this.initPresets();
      this.initGrid9();
    }

    Main.prototype.initTasks = function() {
      this.ookonsole.addTask('add', {
        summary: "Add a new magnubbin to the scene",
        completions: ['add ocrex', 'add slyce', 'add betr'],
        details: "add\n---\n@todo describe. \n\n@todo usage\n",
        runner: function(context, options) {
          var index, oo3d, valid;
          oo3d = context.oo3d;
          valid = ['flatr', 'betr', 'ocrex', 'icos', 'decr', 'sqish', 'slys', 'spyk'];
          if (-1 === valid.indexOf(options[0])) {
            return "Buffer.Position '" + options[0] + "' not recognised";
          }
          index = oo3d.add('Item.Mesh', {
            positionI: context[options[0] + 'PositionI'],
            colorI: context.genericColorI
          });
          oo3d.edit(index, {
            sX: 0.25,
            sY: 0.25,
            sZ: 0.25
          });
          oo3d._all[context.rendererI].meshes.push(oo3d._all[index]);
          context.changeFocus(index);
          oo3d.render();
          return "Added " + options[0] + ". Focused on index " + index;
        }
      });
      this.ookonsole.addTask('delete', {
        summary: "Remove the focused Item.Mesh from the scene",
        completions: ['delete'],
        details: "delete\n-----\n@todo describe. \n\n@todo usage\n",
        runner: function(context, options) {
          if (context.focusI) {
            context.oo3d["delete"](context.focusI);
            context.oo3d.render();
            context.focusI = void 0;
            return "Deleted index '" + context.focusI + "'";
          } else {
            return "Cannot delete the camera";
          }
        }
      });
      this.ookonsole.addTask('focus', {
        summary: "Focus on one of the magnubbins",
        completions: ['focus '],
        details: "focus\n-----\n@todo describe. \n\n@todo usage\n",
        runner: function(context, options) {
          var index, ref;
          index = options[0];
          if (!/^\d+$/.test(index)) {
            return "'" + index + "' is not a valid index - must be an integer";
          } else if ('Item.Mesh' !== ((ref = context.oo3d._all[+index]) != null ? ref.C : void 0)) {
            return "'" + index + "' is not the index of an Item.Mesh";
          } else {
            context.changeFocus(+index);
            context.oo3d.render();
            return "Focused on index '" + index + "'";
          }
        }
      });
      this.ookonsole.addTask('blur', {
        summary: "Focus on the camera",
        completions: ['blur'],
        details: "blur\n-----\n@todo describe. \n\n@todo usage\n",
        runner: function(context, options) {
          context.changeFocus();
          context.oo3d.render();
          return "Focused on the camera";
        }
      });
      this.ookonsole.addTask('edit', {
        summary: "Edit the focused Item.Mesh, or the camera",
        completions: ['edit '],
        details: "edit\n----\n@todo describe. \n\n@todo usage\n",
        runner: function(context, options) {
          var delta, i, l, option, set, value;
          set = {};
          delta = {};
          i = 0;
          l = options.length;
          while (i < l) {
            option = options[i++];
            value = +options[i++];
            if (!/^d?[rst][xyz]$/.test(option)) {
              return "`options[" + (i - 2) + "]` is invalid, use 'dtx', 'sz', etc";
            }
            if (isNaN(value)) {
              return "`options[" + (i - 1) + "]` is invalid, must be numeric";
            }
            if ('d' !== option.charAt(0)) {
              set[option[0] + option[1].toUpperCase()] = value;
            } else {
              delta[option[1] + option[2].toUpperCase()] = value;
            }
          }
          if (context.focusI) {
            context.oo3d.edit(context.focusI, set, delta);
            context.oo3d.render();
            return "Edited index '" + context.focusI + "'";
          } else {
            context.oo3d.edit(context.cameraI, set, delta);
            context.oo3d._all[context.cameraI].updateCamera();
            context.oo3d.render();
            return "Edited the camera";
          }
        }
      });
      this.ookonsole.addTask('reset', {
        summary: "Reset the focused Item.Mesh, or the camera",
        completions: ['reset'],
        details: "reset\n-----\n@todo describe. \n\n@todo usage\n",
        runner: function(context, options) {
          if (context.focusI) {
            context.oo3d.edit(context.focusI, 'reset');
            context.oo3d.edit(context.focusI, {
              sX: 0.25,
              sY: 0.25,
              sZ: 0.25
            });
            context.oo3d.render();
            return "Reset index '" + context.focusI + "'";
          } else {
            context.oo3d.edit(context.cameraI, 'reset');
            context.oo3d._all[context.cameraI].updateCamera();
            context.oo3d.render();
            return "Reset the camera";
          }
        }
      });
      this.ookonsole.addTask('save', {
        summary: "Convert the scene into an Nwang string",
        completions: ['save ', 'save prefix '],
        details: "save\n-----\n@todo describe. \n\n@todo usage\n",
        runner: function(context, options) {
          var instance, j, len, out, pos, ref;
          out = '';
          out += context.oo3d.read(context.cameraI, 'nwang').slice(-9) + ';';
          ref = context.oo3d._all;
          for (j = 0, len = ref.length; j < len; j++) {
            instance = ref[j];
            if ('Item.Mesh' === (instance != null ? instance.C : void 0)) {
              out += context.oo3d.read(instance.index, 'nwang').slice(-11) + ';';
            }
          }
          out = out.slice(0, -1);
          pos = options.indexOf('prefix');
          if (-1 !== pos) {
            if (!options[pos + 1]) {
              return "The 'prefix' option must be followed by text";
            } else {
              out = options[pos + 1] + out;
            }
          }
          if (-1 !== options.indexOf('prompt')) {
            prompt('Save:', out);
          }
          return "Save: " + out;
        }
      });
      return this.ookonsole.addTask('restore', {
        summary: "Replace the current scene with an Nwang-defined scene",
        completions: ['restore '],
        details: "restore\n-------\n@todo describe. \n\n@todo usage\n",
        runner: function(context, options) {
          var camera, index, item, items, j, len, oo3d;
          if (!options[0]) {
            return "no restore-string provided";
          }
          oo3d = context.oo3d;
          items = options[0].split(';');
          camera = items.shift();
          oo3d.edit(context.cameraI, camera);
          oo3d._all[context.cameraI].updateCamera();
          for (j = 0, len = items.length; j < len; j++) {
            item = items[j];
            index = oo3d.add('Item.Mesh');
            oo3d.edit(index, item);
            oo3d._all[context.rendererI].meshes.push(oo3d._all[index]);
          }
          oo3d.render();
          return "Restored " + items.length + " mesh" + (1 === items.length ? '' : 'es');
        }
      });
    };

    Main.prototype.initPresets = function() {
      var $preset, j, len, ref, results;
      return;
      this.$$presets = $$('.magnubbin-presets >li');
      ref = this.$$presets;
      results = [];
      for (j = 0, len = ref.length; j < len; j++) {
        $preset = ref[j];
        $preset.removeEventListener('click', onPresetClick);
        results.push($preset.addEventListener('click', onPresetClick));
      }
      return results;
    };

    Main.prototype.initGrid9 = function() {
      var deltaCalc, fn, fn1, fn2, id, main, meshName, meshNames, meshdeltaCalcs, scenedeltaCalcs;
      $('.magnubbin-view').addEventListener('mousedown', (function(_this) {
        return function(event) {
          var $control, $icon, $preexisting, color, h, hRatio, meshI, w, wRatio, wh, x, y;
          wh = vpSize();
          w = wh[0];
          h = wh[1];
          wRatio = _this.$main.width / w;
          hRatio = _this.$main.height / h;
          x = Math.round(wRatio * event.clientX);
          y = Math.round(hRatio * event.clientY);
          color = _this.oo3d.getColorAt(x, _this.$main.height - y);
          meshI = _this.oo3d.getMeshIByColor(color);
          if (16777215 === meshI) {
            _this.ookonsole.execute('blur');
          } else {
            _this.ookonsole.execute('focus ' + meshI);
          }
          $preexisting = $('.magnubbin-preexisting');
          $icon = $('.magnubbin-icon-info');
          $control = $('.magnubbin-control');
          $icon = $('.magnubbin-icon-control');
          $preexisting.className = 'magnubbin-preexisting';
          $icon.className = 'magnubbin-icon-info';
          $control.className = 'magnubbin-control';
          return $icon.className = 'magnubbin-icon-control';
        };
      })(this));
      $('#grid9-scene-add').addEventListener('mousedown', function(event) {
        return grid9OnlyShow($('#grid9-add'));
      });
      $('#grid9-scene-save').addEventListener('mousedown', (function(_this) {
        return function(event) {
          return _this.ookonsole.execute("save prompt prefix " + location.protocol + "//" + (location.host + location.pathname) + "?scene_v1=");
        };
      })(this));
      $('#grid9-scene-reset').addEventListener('mousedown', (function(_this) {
        return function(event) {
          return _this.ookonsole.execute('reset');
        };
      })(this));
      scenedeltaCalcs = {
        'grid9-scene-txy': txyDelta,
        'grid9-scene-txz': txzDelta,
        'grid9-scene-rxy': rxyDelta,
        'grid9-scene-ryz': ryzDelta,
        'grid9-scene-scale': scaleDelta
      };
      fn = function(id, deltaCalc) {
        $('#' + id).addEventListener('mousedown', function(event) {
          return onMousedown(event, $('#grid9-scene'), deltaCalc);
        });
        return $('#' + id).addEventListener('touchstart', function(event) {
          return onTouchstart(event, $('#grid9-scene'), deltaCalc);
        });
      };
      for (id in scenedeltaCalcs) {
        deltaCalc = scenedeltaCalcs[id];
        fn(id, deltaCalc);
        void 0;
      }
      $('#grid9-add-back').addEventListener('mousedown', (function(_this) {
        return function(event) {
          return grid9OnlyShow($('#grid9-mesh'));
        };
      })(this));
      meshNames = {
        'grid9-add-shape-0': 'flatr',
        'grid9-add-shape-1': 'betr',
        'grid9-add-shape-2': 'ocrex',
        'grid9-add-shape-3': 'icos',
        'grid9-add-shape-4': 'decr',
        'grid9-add-shape-5': 'sqish',
        'grid9-add-shape-6': 'slys',
        'grid9-add-shape-7': 'spyk'
      };
      fn1 = function(id, meshName) {
        return $('#' + id).addEventListener('mousedown', function(event) {
          return main.ookonsole.execute('add ' + meshName);
        });
      };
      for (id in meshNames) {
        meshName = meshNames[id];
        main = this;
        fn1(id, meshName);
        void 0;
      }
      $('#grid9-mesh-delete').addEventListener('mousedown', (function(_this) {
        return function(event) {
          return _this.ookonsole.execute('delete');
        };
      })(this));
      $('#grid9-mesh-flip').addEventListener('mousedown', function(event) {
        return grid9OnlyShow($('#grid9-flip'));
      });
      $('#grid9-mesh-reset').addEventListener('mousedown', (function(_this) {
        return function(event) {
          return _this.ookonsole.execute('reset');
        };
      })(this));
      meshdeltaCalcs = {
        'grid9-mesh-txy': txyDelta,
        'grid9-mesh-txz': txzDelta,
        'grid9-mesh-rxy': rxyDelta,
        'grid9-mesh-ryz': ryzDelta,
        'grid9-mesh-scale': scaleDelta
      };
      fn2 = function(id, deltaCalc) {
        $('#' + id).addEventListener('mousedown', function(event) {
          return onMousedown(event, $('#grid9-mesh'), deltaCalc);
        });
        return $('#' + id).addEventListener('touchstart', function(event) {
          return onTouchstart(event, $('#grid9-mesh'), deltaCalc);
        });
      };
      for (id in meshdeltaCalcs) {
        deltaCalc = meshdeltaCalcs[id];
        fn2(id, deltaCalc);
        void 0;
      }
      $('#grid9-flip-back').addEventListener('mousedown', (function(_this) {
        return function(event) {
          return grid9OnlyShow($('#grid9-mesh'));
        };
      })(this));
      $('#grid9-flip-x').addEventListener('mousedown', (function(_this) {
        return function(event) {
          return _this.ookonsole.execute('edit dsx -1');
        };
      })(this));
      $('#grid9-flip-y').addEventListener('mousedown', (function(_this) {
        return function(event) {
          return _this.ookonsole.execute('edit dsy -1');
        };
      })(this));
      return $('#grid9-flip-z').addEventListener('mousedown', (function(_this) {
        return function(event) {
          return _this.ookonsole.execute('edit dsz -1');
        };
      })(this));
    };

    Main.prototype.changeFocus = function(focusI) {
      var $grid9Mesh, instance, j, len, ref;
      this.focusI = focusI;
      ref = this.oo3d._all;
      for (j = 0, len = ref.length; j < len; j++) {
        instance = ref[j];
        if (!instance) {
          continue;
        }
        if ('Item.Mesh' === instance.C) {
          this.oo3d.setRenderMode('TRIANGLES', instance.index);
        }
      }
      if (ªN === typeof focusI) {
        this.oo3d.setRenderMode('LINE_LOOP', focusI);
        return grid9OnlyShow($('#grid9-mesh'));
      } else {
        $grid9Mesh = $('#grid9-scene');
        if ('grid9 active' === $grid9Mesh.getAttribute('class')) {
          return grid9OnlyShow();
        } else {
          return grid9OnlyShow($grid9Mesh);
        }
      }
    };

    Main.prototype.updateMeshInfo = function() {
      return 1;
    };

    return Main;

  })();

  injectCSS = function($cssTarget, title) {
    return $cssTarget.innerHTML = "/* `@import` must go first */\n@import url(http://fonts.googleapis.com/css?family=Podkova);\n\n" + $cssTarget.innerHTML + "\n\n/* " + title + " */\n\n\n/* LAYOUT */\nhtml, body {\n  overflow: hidden;\n}\na img:active {\n  outline: none;\n}\n\n\n/* MAIN SECTIONS */\n.magnubbin-main {\n  color: #9fc;\n}\n.magnubbin-main >* {\n  position: absolute;\n  box-sizing: border-box;\n  top:    0;\n  bottom: 0;\n  padding: 1rem;\n}\n.magnubbin-view {\n  left:   0;\n  right:  0;\n  padding: 0;\n  background: transparent; /* was rgba(30,50,40,0.7) */\n}\n\n\n/* MIN/MAX BUTTONS */\n.magnubbin-panel-minmax {\n  left:    0;\n  right:   0;\n  padding: 0;\n  height:  1px;\n  z-index: 20;\n}\n.magnubbin-panel-minmax >a {\n  display:    block;\n  position:   relative;\n  margin:     0.6rem 1rem;\n  padding:    0;\n  width:      1em;\n  height:     1em;\n  max-width:  1em;\n  max-height: 1em;\n  border: 2px solid; /* same as text color */\n  border-radius: 2em;\n  font: bold italic 2em serif;\n}\n.magnubbin-icon-info:before {\n  display: inline-block;\n  position: absolute;\n  margin-left: 0.35em;\n  content: \"i\";\n}\n.magnubbin-icon-info.active:before {\n  content: \"×\";\n  font-style: normal;\n  margin: -0.1em 0 0 0.22em;\n}\n.magnubbin-icon-control:before {\n  display: inline-block;\n  position: absolute;\n  margin: -0.1em 0 0 0.25em;\n  content: \"§\";\n}\n.magnubbin-icon-control.active:before {\n  content: \"×\";\n  font-style: normal;\n  margin: -0.1em 0 0 0.22em;\n}\n.magnubbin-toggle-preexisting {\n  float: left;\n}\n.magnubbin-toggle-command {\n  float: right;\n}\n\n.magnubbin-logo {\n  display: none; /*@todo perhaps show this again */\n  font: bold 1.5em Podkova;\n}\n.magnubbin-control .magnubbin-logo {\n  float: right;\n}\n\n\n/* XX */\n.magnubbin-main a {\n  color: #c69;\n  text-decoration: none;\n  transition: all 0.5s;\n}\n.magnubbin-main a:hover {\n  color: #f6d;\n}\n\n.magnubbin-control {\n  display: flex;\n  flex-direction: column;\n  justify-content: flex-end;\n  padding:    0;\n  right:      0;\n  width:      0;\n  min-width:  0;\n  max-width:  0;\n  height:   100%;\n  background: rgba(0,0,0,0.9);\n  opacity:    0;\n  transition: all 0.3s;\n}\n.magnubbin-control.active {\n  padding:    1rem;\n  width:     25%;\n  min-width: 35rem; /* usual maximum ookonsole-display lines */\n  max-width: 35rem; /* usual maximum ookonsole-display lines */\n  opacity:    1;\n}\n.magnubbin-control >* {\n  flex-basis: 0%; /* log is '100%', so expands to fill */\n}\n.magnubbin-control h2 {\n  margin: 0;\n  padding: 0.3em 0;\n}\n.magnubbin-control h2 tt {\n  color: #eee;\n  font: bold 1em monaco, monospace;\n}\n.magnubbin-control ul,\n.magnubbin-control pre {\n  margin-top: 0.5em;\n}\n\n\n/* 3D CONTEXT */\n#oo3d-main {\n  position: absolute;\n  top:     0;\n  left:    0;\n  width:   100%;\n  height:  100%;\n  z-index: -1;\n}\n\n\n/* INFO PANEL */\n.magnubbin-preexisting {\n  left:      -101%;\n  width:      100%;\n  background: rgba(0,0,0,0.9) url(build/asset/magnubbin-info-bkgnd.png) center center;\n  background-size: cover;\n  text-align: center;\n  opacity:      0;\n  transition:   all 0.3s;\n}\n.magnubbin-preexisting.active {\n  left:    0;\n  opacity: 1;\n}\n.magnubbin-preexisting h1 {\n  display: none;\n  margin-top: 2.5rem;\n}\na[title=\"Visit the Loop.Coop homepage\"] {\n  display: block;\n  margin-top: 8rem;\n}\na[title=\"Refresh Magnubbin\"] {\n  display: block;\n}\n.magnubbin-preexisting h4 {\n  font-size: 1.5em;\n  text-shadow: -2px 0 black, 0 2px black, 2px 0 black, 0 -2px black\n}\n.magnubbin-preexisting h5 strong {\n  display: inline-block;\n  padding: 0.5em 1em 0.4em 1em;\n  font-size: 2em;\n  background-color: rgba(0,0,0,0.7);\n  border: 2px solid;\n  border-radius: 0.2em;\n  cursor: pointer;\n  transition: all 0.5s;\n}\n.magnubbin-preexisting h5 strong:hover {\n  color: #0f3;\n}\n.magnubbin-preexisting ol {\n  display: inline-block;\n  padding: 1rem 1rem 1rem 3rem;\n  text-align: left; \n  background-color: rgba(0,0,0,0.7);\n  border: 2px solid;\n  border-radius: 0.2em;\n}\na[title=\"GitHub\"] {\n  position: fixed;\n  left: 0;\n  right: 0;\n  bottom: 0.5rem;\n}\n@media only screen and (max-width: 830px) {\n  a[title=\"Visit the Loop.Coop homepage\"] {\n    margin-top: 5rem;\n  }\n  a[title=\"Visit the Loop.Coop homepage\"] img {\n    width: 38%;\n    height: auto;\n  }\n  a[title=\"Refresh Magnubbin\"] img {\n    width: 80%;\n    height: auto;\n  }\n}\n@media only screen and (max-height: 850px) {\n  a[title=\"Visit the Loop.Coop homepage\"] {\n    margin-top: 5rem;\n  }\n}\n@media only screen and (max-height: 800px) {\n  a[title=\"Visit the Loop.Coop homepage\"] {\n    margin-top: 2rem;\n  }\n  .magnubbin-preexisting ol {\n    padding: 0.6rem 0.6rem 0.6rem 2rem;\n    font-size: 0.8em;\n  }\n}\n@media only screen and (max-height: 680px) {\n  .magnubbin-preexisting ol {\n    display: none;\n  }\n}\n@media only screen and (max-height: 450px) {\n  a[title=\"GitHub\"] {\n    display: none;\n  }\n}\n\n\n/* PRESETS */\n/*@todo perhaps reinstate presets in a later version? */\n/*\nul.magnubbin-presets {\n  clear: both;\n  margin: 0 0 0.2em 0;\n  padding: 0;\n}\n.magnubbin-presets >li {\n  display: inline-block;\n  padding: 0.5em 0.8em;\n  margin: 0 0.2em 0.5em 0;\n  list-style-type: none;\n  border: 2px solid;\n  border-radius: 0.2em;\n  color: #9fc;\n  cursor: pointer;\n  transition: all 0.5s;\n}\n.magnubbin-presets >li:hover {\n  color: #0f3;\n}\n*/\n\n\n/* DISPLAY AND COMMAND */\n.magnubbin-control #ookonsole-display {\n  flex-basis: 100%; /* override 1px */\n  margin: 0;\n  padding: 0;\n  border-width: 0;\n  border-radius: 0.4em 0.4em 0 0;\n  font: 0.75rem \"monaco\", monospace;\n}\n.magnubbin-control.active #ookonsole-display {\n  padding: 0.75em 0.8em;\n  border: 2px solid;\n}\n#ookonsole-command {\n  display: block;\n  box-sizing: border-box;\n  width: 100%;\n  padding: 0;\n  border-width: 0;\n  border-radius: 0 0 0.4em 0.4em;\n  font: 1em \"monaco\", monospace;\n  color: #eee;\n  background: transparent;\n}\n.magnubbin-control.active #ookonsole-command {\n  padding: 0.5em;\n  border: 2px solid #9fc;\n}\n\n\n/* ERROR */\n#magnubbin-error {\n  position: absolute;\n  box-sizing: border-box;\n  bottom:  0;\n  left:    5%;\n  width:  90%;\n  padding: 1rem;\n  font-family: monaco, monospace;\n  background-color: #933;\n  color: #fff;\n  transition: all 0.5s;\n  opacity: 1;\n}\n#magnubbin-error.hidden {\n  padding-bottom: 0;\n  opacity: 0;\n}\n\n/* GRID9 */\n.magnubbin-grid9 {\n  opacity: 1;\n  transition: all 0.3s;\n}\n.magnubbin-grid9.active {\n  opacity: 0.4;\n}\n.grid9 {\n  position:    fixed;\n  display:     block;\n  padding:     0;\n  width:       0;\n  height:      0;\n  left:        50%;\n  margin-left: -145px;\n  top:         50%;\n  margin-top:  -125px;\n  opacity:     0;  /* '1' when active */\n  z-index:     -5; /* '10' when active */\n  transition: opacity 0.4s, z-index 0.1s 0.5s;\n}\n.grid9.active {\n  z-index: 10;\n  opacity: 1;\n  transition: opacity 0.4s;\n}\n.grid9 >li {\n  position:    absolute;\n  width:       90px;\n  height:      90px;\n  list-style:  none;\n  text-align:  center;\n  background:  rgba(0,0,0,0.85);\n  cursor: default;\n  transition:  all 0.4s;\n}\n.grid9 >li:hover {\n  color:       #fff;\n  background:  rgba(0,0,0,0.95);\n}\n.grid9.active >li { /* eg during transition */\n  cursor: pointer;\n}\n.grid9 >li >b,\n.grid9 >li >i {\n  display: block;\n  -webkit-touch-callout: none; /* Android and iOS callouts*/\n    -webkit-user-select: none; /* Chrome, Safari, Opera */\n     -khtml-user-select: none; /* Konqueror */\n       -moz-user-select: none; /* Firefox */\n        -ms-user-select: none; /* IE */\n            user-select: none;\n}\n.grid9 >li >b {\n  padding: 10px 0;\n}\n.grid9 >li >i {\n  font: bold 1.25em/1 monaco, monospace;\n}\n.grid9-left {\n  \n}\n.grid9-center {\n  margin-left: 100px;\n}\n.grid9-right {\n  margin-left: 200px;\n}\n.grid9-top {\n  \n}\n.grid9-middle {\n  margin-top: 100px;\n}\n.grid9-bottom {\n  margin-top: 200px;\n}\n\n.grid9 i {\n  font-style: normal;\n}\n\n#grid9-add-shape-0 {\n  background-image: url(build/asset/add-icon-flatr.png); }\n#grid9-add-shape-1 {\n  background-image: url(build/asset/add-icon-betr.png); }\n#grid9-add-shape-2 {\n  background-image: url(build/asset/add-icon-ocrex.png); }\n#grid9-add-shape-3 {\n  background-image: url(build/asset/add-icon-icos.png); }\n#grid9-add-shape-4 {\n  background-image: url(build/asset/add-icon-decr.png); }\n#grid9-add-shape-5 {\n  background-image: url(build/asset/add-icon-sqish.png); }\n#grid9-add-shape-6 {\n  background-image: url(build/asset/add-icon-slys.png); }\n#grid9-add-shape-7 {\n  background-image: url(build/asset/add-icon-spyk.png); }\n\n";
  };

  injectHTML = function($htmlTarget, title) {
    $htmlTarget.className += ' magnubbin-wrap';
    $htmlTarget.innerHTML = "\n\n\n<!-- " + title + " -->\n\n<!-- The main Magnubbin elements -->\n<main class=\"magnubbin-main\">\n  <section class=\"magnubbin-view\">\n    <canvas id=\"oo3d-main\" width=\"600\" height=\"450\"></canvas><!-- @todo resize with window -->\n    <!--<a href=\"http://loop.coop/\" title=\"Created by Loop.Coop\" class=\"magnubbin-logo\">Loop.Coop</a>-->\n    <div id=\"magnubbin-error\" class=\"hidden\"></div>\n  </section>\n\n  <section class=\"magnubbin-grid9\">\n\n    <!-- The Scene Grid9 appears when the background is clicked -->\n    <ul id=\"grid9-scene\" class=\"grid9\">\n      <li id=\"grid9-scene-add\"    class=\"grid9-left   grid9-top\"   ><b>Add</b   ><i>+</i></li>\n      <li id=\"grid9-scene-save\"   class=\"grid9-right  grid9-top\"   ><b>Save</b  ><i>[]</i></li>\n      <li id=\"grid9-scene-txy\"    class=\"grid9-left   grid9-middle\"><b>Move</b  ><i>x y</i></li>\n      <li id=\"grid9-scene-scale\"  class=\"grid9-center grid9-middle\"><b>Zoom</b  ><i></i></li>\n      <li id=\"grid9-scene-txz\"    class=\"grid9-right  grid9-middle\"><b>Move</b  ><i>x z</i></li>\n      <li id=\"grid9-scene-rxy\"    class=\"grid9-left   grid9-bottom\"><b>Rotate</b><i>x y</i></li>\n      <li id=\"grid9-scene-reset\"  class=\"grid9-center grid9-bottom\"><b>Reset</b ><i>/</i></li>\n      <li id=\"grid9-scene-ryz\"    class=\"grid9-right  grid9-bottom\"><b>Rotate</b><i>y z</i></li>\n    </ul>\n\n    <!-- The Add Grid9 appears when the 'Add' button is clicked -->\n    <ul id=\"grid9-add\" class=\"grid9\">\n      <li id=\"grid9-add-back\"    class=\"grid9-left   grid9-top\"   ><b>Back</b><i>&lt;</i></li>\n      <li id=\"grid9-add-shape-0\" class=\"grid9-center grid9-top\"   ><b>Add</b><i></i></li>\n      <li id=\"grid9-add-shape-1\" class=\"grid9-right  grid9-top\"   ><b>Add</b><i></i></li>\n      <li id=\"grid9-add-shape-2\" class=\"grid9-left   grid9-middle\"><b>Add</b><i></i></li>\n      <li id=\"grid9-add-shape-3\" class=\"grid9-center grid9-middle\"><b>Add</b><i></i></li>\n      <li id=\"grid9-add-shape-4\" class=\"grid9-right  grid9-middle\"><b>Add</b><i></i></li>\n      <li id=\"grid9-add-shape-5\" class=\"grid9-left   grid9-bottom\"><b>Add</b><i></i></li>\n      <li id=\"grid9-add-shape-6\" class=\"grid9-center grid9-bottom\"><b>Add</b><i></i></li>\n      <li id=\"grid9-add-shape-7\" class=\"grid9-right  grid9-bottom\"><b>Add</b><i></i></li>\n    </ul>\n\n    <!-- The Mesh Grid9 appears when a mesh in the 3D scene is clicked -->\n    <ul id=\"grid9-mesh\" class=\"grid9\">\n      <li id=\"grid9-mesh-delete\" class=\"grid9-left   grid9-top   \"><b>Delete</b><i>&times;</i></li>\n      <li id=\"grid9-mesh-flip\"   class=\"grid9-right  grid9-top   \"><b>Flip</b  ><i>...</i></li>\n      <li id=\"grid9-mesh-txy\"    class=\"grid9-left   grid9-middle\"><b>Move</b  ><i>x y</i></li>\n      <li id=\"grid9-mesh-scale\"  class=\"grid9-center grid9-middle\"><b>Scale</b ><i></i></li>\n      <li id=\"grid9-mesh-txz\"    class=\"grid9-right  grid9-middle\"><b>Move</b  ><i>x z</i></li>\n      <li id=\"grid9-mesh-rxy\"    class=\"grid9-left   grid9-bottom\"><b>Rotate</b><i>x y</i></li>\n      <li id=\"grid9-mesh-reset\"  class=\"grid9-center grid9-bottom\"><b>Reset</b ><i>/</i></li>\n      <li id=\"grid9-mesh-ryz\"    class=\"grid9-right  grid9-bottom\"><b>Rotate</b><i>y z</i></li>\n    </ul>\n\n    <!-- The Flip Grid9 appears when the 'Flip' button is clicked -->\n    <ul id=\"grid9-flip\" class=\"grid9\">\n      <li id=\"grid9-flip-back\"  class=\"grid9-left   grid9-top\"   ><b>Back</b ><i>&lt;</i></li>\n      <li id=\"grid9-flip-x\"     class=\"grid9-left   grid9-middle\"><b>Flip</b><i>x</i></li>\n      <li id=\"grid9-flip-y\"     class=\"grid9-center grid9-middle\"><b>Flip</b><i>y</i></li>\n      <li id=\"grid9-flip-z\"     class=\"grid9-right  grid9-middle\"><b>Flip</b><i>z</i></li>\n    </ul>\n\n  </section>\n\n  <section class=\"magnubbin-panel-minmax\">\n    <a href=\"#/\" title=\"Toggle info\" class=\"magnubbin-toggle-preexisting\">\n      <span class=\"magnubbin-icon-info\"></span>\n    </a>\n    <a href=\"#/\" title=\"Toggle command\" class=\"magnubbin-toggle-command\">\n      <span class=\"magnubbin-icon-control\"></span>\n    </a>\n  </section>\n\n  <section class=\"magnubbin-control\">\n    <!--@todo perhaps reinstate presets in a later version? -->\n    <!--\n    <ul class=\"magnubbin-presets\">\n      <li data-command=\"clear\">Clear</li>\n      <li data-command=\"add flatr\">Add Flatr</li>\n      <li data-command=\"add betr\" >Add Betr</li>\n      <li data-command=\"add ocrex\">Add Ocrex</li>\n      <li data-command=\"add icos\" >Add Icos</li>\n      <li data-command=\"add decr\" >Add Decr</li>\n      <li data-command=\"add sqish\">Add Sqish</li>\n      <li data-command=\"add slys\" >Add Slys</li>\n      <li data-command=\"add spyk\" >Add Spyk</li>\n    </ul>\n    <ul class=\"magnubbin-presets\">\n      <li data-command=\"edit drx -20\">rx-</li>\n      <li data-command=\"edit drx 20\" >rx+</li>\n      <li data-command=\"edit dry -20\">ry-</li>\n      <li data-command=\"edit dry 20\" >ry+</li>\n      <li data-command=\"edit drz -20\">rz-</li>\n      <li data-command=\"edit drz 20\" >rz+</li>\n    </ul>\n    <ul class=\"magnubbin-presets\">\n      <li data-command=\"edit dsx 2.0 dsy 2.0 dsz 2.0\">&times;2</li>\n      <li data-command=\"edit dsx 0.5 dsy 0.5 dsz 0.5\" >&divide2</li>\n      <li data-command=\"edit dsx -1\">fx</li>\n      <li data-command=\"edit dsy -1\">fy</li>\n      <li data-command=\"edit dsz -1\">fz</li>\n    </ul>\n    <ul class=\"magnubbin-presets\">\n      <li data-command=\"edit dtx -0.2\">x-</li>\n      <li data-command=\"edit dtx 0.2\" >x+</li>\n      <li data-command=\"edit dty -0.2\">y-</li>\n      <li data-command=\"edit dty 0.2\" >y+</li>\n      <li data-command=\"edit dtz -0.2\">z-</li>\n      <li data-command=\"edit dtz 0.2\" >z+</li>\n    </ul>\n    <ul class=\"magnubbin-presets magnubbin-focus-presets\">\n      <li data-command=\"blur\">Focus Camera</li>\n    </ul>\n    -->\n    <h2>Type <tt>help</tt> to list commands:</h2>\n    <pre id=\"ookonsole-display\"></pre>\n    <div><input id=\"ookonsole-command\"></div>\n  </section>\n  <section class=\"magnubbin-preexisting\">\n    " + $htmlTarget.innerHTML + "\n  </section>\n</main>\n";
    $('.magnubbin-toggle-preexisting').addEventListener('click', function() {
      var $icon, $preexisting;
      $preexisting = $('.magnubbin-preexisting');
      $icon = $('.magnubbin-icon-info');
      if (/active/.test($preexisting.className)) {
        $preexisting.className = 'magnubbin-preexisting';
        return $icon.className = 'magnubbin-icon-info';
      } else {
        $preexisting.className = 'magnubbin-preexisting active';
        $icon.className = 'magnubbin-icon-info active';
        $('.magnubbin-control').className = 'magnubbin-control';
        $('.magnubbin-icon-control').className = 'magnubbin-icon-control';
        return grid9OnlyShow();
      }
    });
    $('.magnubbin-toggle-command').addEventListener('click', function() {
      var $control, $icon;
      $control = $('.magnubbin-control');
      $icon = $('.magnubbin-icon-control');
      if (/active/.test($control.className)) {
        $control.className = 'magnubbin-control';
        return $icon.className = 'magnubbin-icon-control';
      } else {
        $control.className = 'magnubbin-control active';
        $icon.className = 'magnubbin-icon-control active';
        $('.magnubbin-preexisting').className = 'magnubbin-preexisting';
        $('.magnubbin-icon-info').className = 'magnubbin-icon-info';
        grid9OnlyShow();
        return $('#ookonsole-command').focus();
      }
    });
    return $('.magnubbin-preexisting h5 strong').addEventListener('click', function() {
      $('.magnubbin-preexisting').className = 'magnubbin-preexisting';
      $('.magnubbin-icon-info').className = 'magnubbin-icon-info';
      return grid9OnlyShow();
    });
  };

  onPresetClick = function(event) {
    var error;
    try {
      return window.magnubbin.ookonsole.execute(event.target.getAttribute('data-command'));
    } catch (_error) {
      error = _error;
      $('#magnubbin-error').innerHTML = error;
      return $('#magnubbin-error').className = '';
    }
  };

  vpSize = function(event) {
    var b, d, e, h, w;
    d = document;
    e = d.documentElement;
    b = d.getElementsByTagName('body')[0];
    w = window.innerWidth || e.clientWidth || b.clientWidth;
    h = window.innerHeight || e.clientHeight || b.clientHeight;
    return [w, h];
  };

  grid9OnlyShow = function($el) {
    var $grid9, j, len, ref;
    ref = $$('.grid9');
    for (j = 0, len = ref.length; j < len; j++) {
      $grid9 = ref[j];
      $grid9.setAttribute('class', 'grid9');
    }
    if ($el) {
      return $el.setAttribute('class', 'grid9 active');
    }
  };

  grid9IsActive = function(id) {
    return 'gui active' === $('#' + id).getAttribute('class');
  };

  onMousedown = function(event, $el, deltaCalc) {
    var main;
    event.preventDefault();
    main = window.magnubbin;
    main.deltaCalc = deltaCalc;
    main.downPos = [event.clientX, event.clientY];
    main.snapshot = main.oo3d.read(main.focusI || main.cameraI);
    main.delta = null;
    $('.magnubbin-grid9').className = 'magnubbin-grid9 active';
    window.addEventListener('mousemove', onMousemove);
    return window.addEventListener('mouseup', onMouseup);
  };

  onTouchstart = function(event, $el, deltaCalc) {
    var main, touches;
    event.preventDefault();
    main = window.magnubbin;
    main.deltaCalc = deltaCalc;
    touches = event.changedTouches;
    main.downPos = [touches[0].pageX, touches[0].pageY];
    main.snapshot = main.oo3d.read(main.focusI || main.cameraI);
    main.delta = null;
    $('.magnubbin-grid9').className = 'magnubbin-grid9 active';
    window.addEventListener('touchmove', onTouchmove);
    return window.addEventListener('touchend', onTouchend);
  };

  onMousemove = function(event) {
    var main, oo3d, x, y;
    main = window.magnubbin;
    if (main.downPos) {
      oo3d = main.oo3d;
      x = event.clientX - main.downPos[0];
      y = event.clientY - main.downPos[1];
      main.delta = main.deltaCalc(x, y);
      oo3d.edit(main.focusI || main.cameraI, main.snapshot, main.delta);
      if (!main.focusI) {
        oo3d._all[main.cameraI].updateCamera();
      }
      oo3d.render();
      return main.updateMeshInfo();
    }
  };

  onTouchmove = function(event) {
    var main, oo3d, touches, x, y;
    main = window.magnubbin;
    if (main.downPos) {
      oo3d = main.oo3d;
      touches = event.changedTouches;
      x = touches[0].pageX - main.downPos[0];
      y = touches[0].pageY - main.downPos[1];
      main.delta = main.deltaCalc(x, y);
      oo3d.edit(main.focusI || main.cameraI, main.snapshot, main.delta);
      if (!main.focusI) {
        oo3d._all[main.cameraI].updateCamera();
      }
      oo3d.render();
      return main.updateMeshInfo();
    }
  };

  onMouseup = function(event) {
    window.removeEventListener('mousemove', onMousemove);
    window.removeEventListener('mouseup', onMouseup);
    return afterInteraction();
  };

  onTouchend = function(event) {
    window.removeEventListener('touchmove', onTouchmove);
    window.removeEventListener('touchend', onTouchend);
    return afterInteraction();
  };

  afterInteraction = function() {
    var $display, command, hasScrolledToEnd, j, len, main, option, ref;
    main = window.magnubbin;
    $('.magnubbin-grid9').className = 'magnubbin-grid9';
    if (main.delta) {
      command = '§ edit';
      ref = ['rX', 'rY', 'rZ', 'sX', 'sY', 'sZ', 'tX', 'tY', 'tZ'];
      for (j = 0, len = ref.length; j < len; j++) {
        option = ref[j];
        if (ªN === typeof main.delta[option]) {
          command += ' d' + option.toLowerCase() + ' ' + main.delta[option];
        }
      }
      $display = main.ookonsole.$display;
      hasScrolledToEnd = $display.scrollTop > $display.scrollHeight - $display.offsetHeight;
      $display.innerHTML += command + '\n';
      if (hasScrolledToEnd) {
        $display.scrollTop = $display.scrollHeight;
      }
    }
    main.downPos = null;
    main.deltaCalc = function(x, y) {
      return {};
    };
    main.snapshot = null;
    return main.delta = null;
  };

  txyDelta = function(x, y) {
    return {
      tX: x / 500,
      tY: y / -500
    };
  };

  txzDelta = function(x, y) {
    return {
      tX: x / 500,
      tZ: y / 500
    };
  };

  rxyDelta = function(x, y) {
    return {
      rX: y / 500,
      rY: x / 500
    };
  };

  ryzDelta = function(x, y) {
    return {
      rY: x / 500,
      rZ: y / -500
    };
  };

  scaleDelta = function(x, y) {
    var scale;
    scale = Math.abs(1 + (x - y) / 500);
    return {
      sX: scale,
      sY: scale,
      sZ: scale
    };
  };

  parseQuery = function(query) {
    var decode, match, obj, search;
    search = /([^&=]+)=?([^&]*)/g;
    decode = function(s) {
      return decodeURIComponent(s.replace(/\+/g, ' '));
    };
    obj = {};
    while ((match = search.exec(query))) {
      obj[decode(match[1])] = decode(match[2]);
    }
    return obj;
  };

  if (ªF === typeof define && define.amd) {
    define(function() {
      return Main;
    });
  } else if (ªO === typeof module && module && module.exports) {
    module.exports = Main;
  } else {
    this[ªC] = Main;
  }

  if (ªF === typeof define && define.amd) {

  } else if (ªO === typeof module && module && module.exports) {
    Ookonsole = require('ookonsole');
  } else if (this.Ookonsole) {
    Ookonsole = this.Ookonsole;
  } else {
    Ookonsole = window.Ookonsole;
  }

  if ((ªU !== typeof arts) && (ªU !== typeof resolvers) && (ªU !== typeof updaters)) {
    window.magnubbin = new Main({
      $cssTarget: $('style'),
      $htmlTarget: $('article')
    });
  }

}).call(this);

//// End injecting plugins. 


//// Run each updater when the page loads, and when the URL hash changes. 
onHashchange();
window.addEventListener('hashchange', onHashchange);


}).call(this, document) });

  </script>

</head>
<body>

  <article id="apage_readme"
        class="apage"
  data-apage-opath="/README.md"
  data-apage-dname="_"
  data-apage-order="-1"
  data-apage-front='[]'
  data-apage-title="Loop.Coop Present: Magnubbin">
  <h1>Loop.Coop Present: Magnubbin</h1>
  <p><a href="http://loop.coop/" title="Visit the Loop.Coop homepage"><img src="build/asset/loopdotcoop-logo-300x100.gif" alt="Loop.Coop Logo"></a></p>
  <p><a href="" title="Refresh Magnubbin"><img src="build/asset/magnubbin-logo-752x80.gif" alt="Magnubbin Logo"></a></p>
  <h4>A super-rapid 3D prototyping system</h4>
  <h5><strong>Get Started</strong></h5>
  <ol>
  <li>Click on the white background to show the ‘Scene’ menu</li>
  <li>Click ‘Add’, and click one of the eight tetrahedrons</li>
  <li>Click-and-drag ‘Scale’ to change its size</li>
  <li>Click-and-drag ‘Move x y’ to move it left/right and up/down</li>
  <li>Click-and-drag ‘Move x z’ to move it left/right and in/out</li>
  <li>Click-and-drag the ‘Rotate’ buttons</li>
  <li>Click the white background to show the ‘Scene’ menu</li>
  <li>Click ‘Add’ to create another tetrahedron</li>
  <li>Click the white background to show the ‘Scene’ menu</li>
  <li>Click-and-drag ‘Zoom’, ‘Move’ and ‘Rotate’ to change the view</li>
  <li>Click ‘Reset’ to return to the original view</li>
  <li>Click ‘Save’ for a unique URL to keep or share</li>
  </ol>
  <p><a href="https://github.com/loopdotcoop/magnubbin" title="GitHub">Fork Magnubbin on GitHub</a></p>
  
  </article><!-- / #apage_readme -->


  <article id="apage_doc_documentation"
        class="apage"
  data-apage-opath="/doc/00-documentation.md"
  data-apage-dname="_doc_"
  data-apage-order="0"
  data-apage-front='[]'
  data-apage-title="Documentation">
  <h1>Documentation</h1>
  <ul>
  <li><a href="#/">Home</a></li>
  </ul>
  
  </article><!-- / #apage_doc_documentation -->


  <!-- ‘Inspect Element’ here, for Apage’s injected elements -->

</body>
</html>